<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Ye161030">
	
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="ye161030SrhVo" type="com.app.exterms.yearendtax.server.vo.Ye161030SrhVO"/>
	
	<!-- 
	<resultMap id="ye161030" class="com.app.exterms.yearendtax.server.vo.Ye161030VO">
		<result property="dpobCd" column="DPOB_CD" columnIndex="1"/>
		<result property="yrtxBlggYr" column="YRTX_BLGG_YR" columnIndex="2"/>
		<result property="clutSeptCd" column="CLUT_SEPT_CD" columnIndex="3"/>
		<result property="systemkey" column="SYSTEMKEY" columnIndex="4"/>
		<result property="txprDscmNoCntn" column="TXPR_DSCM_NO_CNTN" columnIndex="5"/>
		<result property="suptFmlyRltClCd" column="SUPT_FMLY_RLT_CL_CD" columnIndex="6"/>
		<result property="nnfClCd" column="NNF_CL_CD" columnIndex="7"/>
		<result property="child" column="CHILD" columnIndex="8"/>
		<result property="txprNm" column="TXPR_NM" columnIndex="9"/>
		<result property="bscDdcClCd" column="BSC_DDC_CL_CD" columnIndex="10"/>
		<result property="wmnDdcClCd" column="WMN_DDC_CL_CD" columnIndex="11"/>
		<result property="snprntFmlyDdcClCd" column="SNPRNT_FMLY_DDC_CL_CD" columnIndex="12"/>
		<result property="sccDdcClCd" column="SCC_DDC_CL_CD" columnIndex="13"/>
		<result property="dsbrDdcClCd" column="DSBR_DDC_CL_CD" columnIndex="14"/>
		<result property="chbtAtprDdcClCd" column="CHBT_ATPR_DDC_CL_CD" columnIndex="15"/>
		<result property="age6Lt" column="AGE6_LT" columnIndex="16"/>
		<result property="kybdr" column="KYBDR" columnIndex="17"/>
		<result property="inptDt" column="INPT_DT" columnIndex="18"/>
		<result property="inptAddr" column="INPT_ADDR" columnIndex="19"/>
		<result property="ismt" column="ISMT" columnIndex="20"/>
		<result property="revnDt" column="REVN_DT" columnIndex="21"/>
		<result property="revnAddr" column="REVN_ADDR" columnIndex="22"/>
	</resultMap>
	 -->
	 
	<!-- 
	#############################################################################
	######################## 2017년도 연말정산 로직 시작 ############################
	#############################################################################
	 -->
	 
	<insert id="ye161030DAO.insertYeta2300ToYe161030_S">
		<![CDATA[
			INSERT INTO YE161030 
				( DPOB_CD				
					, YRTX_BLGG_YR		
					, CLUT_SEPT_CD		
					, SYSTEMKEY			
					, TXPR_DSCM_NO_CNTN	
					, SUPT_FMLY_RLT_CL_CD	
					, NNF_CL_CD			
					, TXPR_NM				
					, BSC_DDC_CL_CD		
					, WMN_DDC_CL_CD		
					, SNPRNT_FMLY_DDC_CL_CD
					, SCC_DDC_CL_CD		
					, DSBR_DDC_CL_CD		
					, CHBT_ATPR_DDC_CL_CD	
					, AGE6_LT
					, EDU_DDC_DVCD
				  	, KYBDR
				  	, INPT_DT
				  	, INPT_ADDR
				  	, ISMT
				  	, REVN_DT
				  	, REVN_ADDR
				  	, FAMY_RELA_DIV_CD )
			VALUES ( #dpobCd#			
						, #yrtxBlggYr#		
						, #clutSeptCd#	
						, #systemkey#			
						, #txprDscmNoCntn#
						, #suptFmlyRltClCd#
						, #nnfClCd#
						, #txprNm#				
						, #bscDdcClCd#		
						, #wmnDdcClCd#		
						, #snprntFmlyDdcClCd#
						, #sccDdcClCd#		
						, NVL( ( SELECT MANGE_ITEM11
						     FROM BASS0300
						     WHERE DPOB_CD = #dpobCd#
						     	AND COMM_CD = #dsbrDdcClCd#
						   ), '0')
						, NVL( ( SELECT MANGE_ITEM11
						     FROM BASS0300
						     WHERE DPOB_CD = #dpobCd#
						     	AND COMM_CD = #chbtAtprDdcClCd#
						     	AND RPSTTV_CD = 'Y021'
						   ), 'N')
						, #age6Lt#
						, #eduDdcDvcd#
					  	, #kybdr#
					  	, TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')	
					  	, #inptAddr#
					  	, #ismt#
					  	, TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')	
					  	, #revnAddr#
					  	, #famyRelaDivCd# )
		]]>
	</insert>
	
	<update id="ye161030DAO.updateYeta2300ToYe161030_S">
		<![CDATA[
			UPDATE YE161030
				SET SUPT_FMLY_RLT_CL_CD			= #suptFmlyRltClCd#
						, NNF_CL_CD				= #nnfClCd#	
						, TXPR_NM 				= #txprNm#				
						, BSC_DDC_CL_CD 		= #bscDdcClCd#
						, WMN_DDC_CL_CD 		= #wmnDdcClCd#	
						, SNPRNT_FMLY_DDC_CL_CD = #snprntFmlyDdcClCd#
						, SCC_DDC_CL_CD 		= #sccDdcClCd#	
						, DSBR_DDC_CL_CD		= NVL( ( SELECT MANGE_ITEM11
														   FROM BASS0300
														  WHERE DPOB_CD = #dpobCd#
														  	AND COMM_CD = #dsbrDdcClCd#
														   ), '0')	
						, CHBT_ATPR_DDC_CL_CD 	=  NVL( ( SELECT MANGE_ITEM11
												     FROM BASS0300
												     WHERE DPOB_CD = #dpobCd#
												     	AND COMM_CD = #chbtAtprDdcClCd#
												     	AND RPSTTV_CD = 'Y021'
												   ), 'N')
						, AGE6_LT 				= #age6Lt#
						, EDU_DDC_DVCD			= #eduDdcDvcd#
						, ISMT					= #ismt#
						, REVN_DT				= TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')	
						, REVN_ADDR				= #revnAddr#
						
				WHERE DPOB_CD=#dpobCd#
					AND YRTX_BLGG_YR=#yrtxBlggYr#
					AND CLUT_SEPT_CD=#clutSeptCd#
					AND SYSTEMKEY=#systemkey#
					AND TXPR_DSCM_NO_CNTN=#txprDscmNoCntn#
				]]>
	</update>
	
	<delete id="ye161030DAO.deleteYeta2300ToYe161030_S">
		<![CDATA[
			DELETE FROM YE161030 
				WHERE DPOB_CD=#dpobCd#
					AND YRTX_BLGG_YR=#yrtxBlggYr#
					AND CLUT_SEPT_CD=#clutSeptCd#
					AND SYSTEMKEY=#systemkey#
					AND TXPR_DSCM_NO_CNTN=#txprDscmNoCntn#
				]]>
	</delete>
	
	<select id="ye161030DAO.seleteYeta2300ToYe161030_D" parameterClass="ye161030SrhVo" resultClass="egovMap">
		SELECT * FROM (
			SELECT A.*, ROWNUM RNUM 
			  FROM ( SELECT AA.DPOB_CD				
							, AA.YRTX_BLGG_YR		
							, AA.CLUT_SEPT_CD		
							, AA.SYSTEMKEY			
							, AA.TXPR_DSCM_NO_CNTN	
							, AA.SUPT_FMLY_RLT_CL_CD	
							, AA.SUPT_FMLY_RLT_CL_CD AS suptFmlyRltClCdcommCd 
							, fcBass0300CDNM(AA.DPOB_CD, AA.SUPT_FMLY_RLT_CL_CD) AS suptFmlyRltClCdcommCdNm 
							, AA.NNF_CL_CD	
							, AA.TXPR_NM				
							, AA.BSC_DDC_CL_CD		
							, AA.WMN_DDC_CL_CD		
							, AA.SNPRNT_FMLY_DDC_CL_CD
							, AA.SCC_DDC_CL_CD		
							, AA.DSBR_DDC_CL_CD	
							, ( SELECT COMM_CD
								  FROM BASS0300
								WHERE DPOB_CD = AA.DPOB_CD
									AND MANGE_ITEM11 = AA.DSBR_DDC_CL_CD
									AND RPSTTV_CD = 'Y008'
								) AS dsbrDdcClCdcommCd 
							, ( SELECT COMM_CD_NM
								  FROM BASS0300
								WHERE DPOB_CD = AA.DPOB_CD
									AND MANGE_ITEM11 = AA.DSBR_DDC_CL_CD
									AND RPSTTV_CD = 'Y008'
								) AS dsbrDdcClCdcommCdNm 	
							, AA.CHBT_ATPR_DDC_CL_CD
							, ( SELECT COMM_CD
								  FROM BASS0300
								WHERE DPOB_CD = AA.DPOB_CD
									AND MANGE_ITEM11 = AA.CHBT_ATPR_DDC_CL_CD
									AND RPSTTV_CD = 'Y021'
								)  AS chbtAtprDdcClCdcommCd 
							, ( SELECT COMM_CD_NM
								  FROM BASS0300
								WHERE DPOB_CD = AA.DPOB_CD
									AND MANGE_ITEM11 = AA.CHBT_ATPR_DDC_CL_CD
									AND RPSTTV_CD = 'Y021'
								) AS chbtAtprDdcClCdcommCdNm
							 
							, AA.AGE6_LT
							, AA.EDU_DDC_DVCD				
							, AA.KYBDR				
							, AA.INPT_DT				
							, AA.INPT_ADDR			
							, AA.ISMT				
							, AA.REVN_DT				
							, AA.REVN_ADDR	
							
							, NVL(AA.FAMY_RELA_DIV_CD, BB.FAMY_RELA_DIV_CD)AS FAMY_RELA_DIV_CD
							, NVL(AA.FAMY_RELA_DIV_CD, BB.FAMY_RELA_DIV_CD)AS famyRelaDivCdcommCd 
							, fcBass0300CDNM(AA.DPOB_CD, NVL(AA.FAMY_RELA_DIV_CD, BB.FAMY_RELA_DIV_CD)) AS famyRelaDivCdcommCdNm 
							
						FROM YE161030 AA, PSNL0115 BB
						
					WHERE AA.DPOB_CD 			= #dpobCd#				
						AND AA.YRTX_BLGG_YR 	= #yrtxBlggYr#	
						AND AA.CLUT_SEPT_CD		= #clutSeptCd#		
						AND AA.SYSTEMKEY	  	= #systemkey#
						
						AND AA.DPOB_CD 			= BB.DPOB_CD(+)
						AND AA.SYSTEMKEY 		= BB.SYSTEMKEY(+)
						AND AA.TXPR_DSCM_NO_CNTN= BB.FAMY_RESN_REGN_NUM(+)
							
					ORDER BY AA.DPOB_CD				
							, AA.YRTX_BLGG_YR		
							, AA.CLUT_SEPT_CD		
							, AA.SYSTEMKEY
							, AA.TXPR_NM
							, AA.FAMY_RELA_DIV_CD
							, AA.TXPR_DSCM_NO_CNTN
				
				<![CDATA[					
			) A WHERE ROWNUM <= #lastIndex#
		)WHERE RNUM >= #firstIndex#
		]]>
	</select>
		
	<select id="ye161030DAO.seleteYeta2300ToYe161030ListCnt_S" parameterClass="ye161030SrhVo" resultClass="int">
		SELECT COUNT(*) totcnt
			FROM YE161030 AA, PSNL0115 BB
		WHERE AA.DPOB_CD 			= #dpobCd#				
			AND AA.YRTX_BLGG_YR 	= #yrtxBlggYr#	
			AND AA.CLUT_SEPT_CD		= #clutSeptCd#		
			AND AA.SYSTEMKEY	  	= #systemkey#
								
			AND AA.DPOB_CD 			= BB.DPOB_CD(+)
			AND AA.SYSTEMKEY 		= BB.SYSTEMKEY(+)
			AND AA.TXPR_DSCM_NO_CNTN= BB.FAMY_RESN_REGN_NUM(+)
									
		ORDER BY AA.DPOB_CD				
				, AA.YRTX_BLGG_YR		
				, AA.CLUT_SEPT_CD		
				, AA.SYSTEMKEY
				, AA.TXPR_DSCM_NO_CNTN
	</select>
	
	
	<!-- 
	#############################################################################
	######################## 2017년도 연말정산 로직 종료 ############################
	#############################################################################
	 -->
	 
	
	<!-- +++++++++++++++++++++++++ 2017년도 귀속 로직  시작 ++++++++++++++++++++++++++++++ -->
		
	<delete id="ye161030DAO.deleteYetaP210001_Ye161030VO_2017_Delete_S">
		<![CDATA[
			DELETE FROM YE161030 
				WHERE DPOB_CD=#dpobCd#
					AND YRTX_BLGG_YR=#yrtxBlggYr#
					AND CLUT_SEPT_CD=#clutSeptCd#
					AND SYSTEMKEY=#systemkey# 
				]]>
	</delete>	 
	
	<!-- +++++++++++++++++++++++++ 2017년도 귀속 로직  종료 ++++++++++++++++++++++++++++++ -->
	
	
	 

</sqlMap>
