<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Bass5540">
	
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="bass5540SrhVO" type="com.app.exterms.basis.server.vo.Bass5540SrhVO"/>
	
	<resultMap id="bass5540" class="com.app.exterms.basis.server.vo.Bass5540VO">
		<result property="dpobCd" column="DPOB_CD" columnIndex="1"/>
		<result property="payDducCd" column="PAY_DDUC_CD" columnIndex="2"/>
		<result property="payDducGrpCd" column="PAY_DDUC_GRP_CD" columnIndex="3"/>
		<result property="payDducNm" column="PAY_DDUC_NM" columnIndex="4"/>
		<result property="payDducUseYn" column="PAY_DDUC_USE_YN" columnIndex="5"/>
		<result property="payDducSum" column="PAY_DDUC_SUM" columnIndex="6"/>
		<result property="payDducRto" column="PAY_DDUC_RTO" columnIndex="7"/>
		<result property="yrtxDducDivCd" column="YRTX_DDUC_DIV_CD" columnIndex="8"/>
		<result property="grpApptnDivCd" column="GRP_APPTN_DIV_CD" columnIndex="9"/>
		<result property="payDducBgnnDt" column="PAY_DDUC_BGNN_DT" columnIndex="10"/>
		<result property="payDducEndDt" column="PAY_DDUC_END_DT" columnIndex="11"/>
		<result property="kybdr" column="KYBDR" columnIndex="12"/>
		<result property="inptDt" column="INPT_DT" columnIndex="13"/>
		<result property="inptAddr" column="INPT_ADDR" columnIndex="14"/>
		<result property="ismt" column="ISMT" columnIndex="15"/>
		<result property="revnDt" column="REVN_DT" columnIndex="16"/>
		<result property="revnAddr" column="REVN_ADDR" columnIndex="17"/>
		<result property="pymtDducDivCd" column="PYMT_DDUC_DIV_CD" columnIndex="18"/>
	</resultMap>
	
	<insert id="bass5540DAO.insertBass5540_S">
		<![CDATA[
			INSERT INTO PAYR0470 
				( DPOB_CD
				  , PAY_DDUC_CD
				  , PAY_DDUC_GRP_CD
				  , PAY_DDUC_NM
				  , PAY_DDUC_USE_YN
				  , PAYR_TERM_DDUC_YN
				  , PAY_DDUC_SUM
				  , PAY_DDUC_RTO
				  , YRTX_DDUC_DIV_CD
				  , GRP_APPTN_DIV_CD
				  , PAY_DDUC_BGNN_DT
				  , PAY_DDUC_END_DT
				  , PYMT_DDUC_DIV_CD
				  , KYBDR
				  , INPT_DT
				  , INPT_ADDR
				  , ISMT
				  , REVN_DT
				  , REVN_ADDR )
			VALUES ( #dpobCd#
				  , #payDducCd#
				  , #payDducGrpCd#
				  , #payDducNm#
				  , #payDducUseYn#
				  , #payrTermDducYn#
				  , #payDducSum#
				  , #payDducRto#
				  , #yrtxDducDivCd#
				  , #grpApptnDivCd#
				  , #payDducBgnnDt#
				  , #payDducEndDt#
				  , #pymtDducDivCd#
				  , #kybdr#
				  , TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')
				  , #inptAddr#
				  , #ismt#
				  , TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')
				  , #revnAddr# )
		]]>
	</insert>
	
	<update id="bass5540DAO.updateBass5540_S">
		<![CDATA[
			UPDATE PAYR0470
			SET DPOB_CD=#dpobCd#
				, PAY_DDUC_CD=#payDducCd#
				, PAY_DDUC_GRP_CD=#payDducGrpCd#
				, PAY_DDUC_NM=#payDducNm#
				, PAY_DDUC_USE_YN=#payDducUseYn#
				, PAYR_TERM_DDUC_YN=#payrTermDducYn#
				, PAY_DDUC_SUM=#payDducSum#
				, PAY_DDUC_RTO=#payDducRto#
				, YRTX_DDUC_DIV_CD=#yrtxDducDivCd#
				, GRP_APPTN_DIV_CD=#grpApptnDivCd#
				, PAY_DDUC_BGNN_DT=#payDducBgnnDt#
				, PAY_DDUC_END_DT=#payDducEndDt#
				, PYMT_DDUC_DIV_CD=#pymtDducDivCd#
				, ISMT=#ismt#
				, REVN_DT=TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')
				, REVN_ADDR=#revnAddr#
						WHERE DPOB_CD=#dpobCd#
								AND PAY_DDUC_CD=#payDducCd#
				]]>
	</update>
	
	<delete id="bass5540DAO.deleteBass5540_S">
		<![CDATA[
			DELETE FROM PAYR0470 
						WHERE DPOB_CD=#dpobCd#
								AND PAY_DDUC_CD=#payDducCd#
				]]>
	</delete>
	
	<select id="bass5540DAO.selectBass5540_S" resultMap="bass5540">
		<![CDATA[
			SELECT
				DPOB_CD
				, PAY_DDUC_CD
				, PAY_DDUC_GRP_CD
				, PAY_DDUC_NM
				, PAY_DDUC_USE_YN
				, PAY_DDUC_SUM
				, PAY_DDUC_RTO
				, YRTX_DDUC_DIV_CD
				, GRP_APPTN_DIV_CD
				, PAY_DDUC_BGNN_DT
				, PAY_DDUC_END_DT
				, PYMT_DDUC_DIV_CD
				, KYBDR
				, INPT_DT
				, INPT_ADDR
				, ISMT
				, REVN_DT
				, REVN_ADDR
			FROM PAYR0470
						WHERE DPOB_CD=#dpobCd#
								AND PAY_DDUC_CD=#payDducCd#
				]]>
	</select>
	
	<select id="bass5540DAO.selectBass5540List_D" parameterClass="bass5540SrhVO" resultClass="egovMap">
		SELECT * FROM (
			SELECT A.*, ROWNUM RNUM FROM (
				SELECT
								DPOB_CD
								, PAY_DDUC_CD
								, PAY_DDUC_GRP_CD
								, PAY_DDUC_GRP_CD AS payDducGrpCdcommCd
								, fcBass0300CDNM(#dpobCd#,PAY_DDUC_GRP_CD) AS payDducGrpCdcommCdNm
								, PAY_DDUC_NM
								, PAY_DDUC_USE_YN
								, PAYR_TERM_DDUC_YN
								, PAY_DDUC_SUM
								, PAY_DDUC_RTO
								, YRTX_DDUC_DIV_CD
								, YRTX_DDUC_DIV_CD AS yrtxDducDivCdcommCd
								, fcBass0300CDNM(#dpobCd#,YRTX_DDUC_DIV_CD) AS yrtxDducDivCdcommCdNm
								, GRP_APPTN_DIV_CD
								, GRP_APPTN_DIV_CD AS  grpApptnDivCdcommCd
								, fcBass0300CDNM(#dpobCd#,GRP_APPTN_DIV_CD) AS grpApptnDivCdcommCdNm
								, PAY_DDUC_BGNN_DT
								, PAY_DDUC_END_DT
								, PYMT_DDUC_DIV_CD 
								, PYMT_DDUC_DIV_CD AS pymtDducDivCdcommCd
								, fcBass0300CDNM(#dpobCd#,PYMT_DDUC_DIV_CD) AS pymtDducDivCdcommCdNm
								, KYBDR
								, INPT_DT
								, INPT_ADDR
								, ISMT
								, REVN_DT
								, REVN_ADDR
						FROM PAYR0470
				WHERE 1=1
              <isNotEmpty prepend="AND" property="payDducGrpCd">
				  PAY_DDUC_GRP_CD = #payDducGrpCd#
		       </isNotEmpty>  
		      <isNotEmpty prepend="AND" property="dpobCd" >
			 	DPOB_CD=#dpobCd#
		      </isNotEmpty>
		        <isNotEmpty prepend="AND" property="payDducNm">
				  PAY_DDUC_NM LIKE '%' || #payDducNm# || '%'
		       </isNotEmpty> 
					ORDER BY 
						DPOB_CD ASC
							, PAY_DDUC_CD DESC
		
				<isNotEqual  property="lastIndex" compareValue="-1">
				 <![CDATA[					
					) A WHERE ROWNUM <= #lastIndex#
				)WHERE RNUM >= #firstIndex#
				]]>
				</isNotEqual>	
				<isEqual   property="lastIndex" compareValue="-1">
				  <![CDATA[					
					) A  
				)
				]]>
				</isEqual>
	</select>	
	<select id="bass5540DAO.selectBass5540ListTotCnt_S" parameterClass="bass5540SrhVO" resultClass="int">
		SELECT COUNT(*) totcnt  
			FROM ( SELECT DPOB_CD,
					       PAY_DDUC_CD,
					       PYMT_DDUC_DIV_CD,
					       fcBass0300CDNM (#dpobCd#, PYMT_DDUC_DIV_CD)AS PYMT_DDUC_DIV_NM,
					       PAY_DDUC_GRP_CD AS PAY_EXTPY_GRP_CD,
					       fcBass0300CDNM (#dpobCd#, PAY_DDUC_GRP_CD)AS PAY_EXTPY_GRP_NM,
					       PAY_DDUC_NM,
					       PAY_DDUC_USE_YN,
					       PAY_DDUC_SUM,
					       PAY_DDUC_RTO,
					       '' AS TEMP1,
					       '' AS TEMP2,
					       YRTX_DDUC_DIV_CD,
					       GRP_APPTN_DIV_CD,
					       PAY_DDUC_BGNN_DT,
					       PAY_DDUC_END_DT,
					       PAYR_TERM_DDUC_YN,
					       '' AS TEMP,
					       '' AS YRTX_FREE_DTY_REDU_CD,
			               '' AS ACC_ACC_CD,
			               '' AS SEVE_PAY_YN
					  FROM PAYR0470
					  WHERE 1=1
					  <isNotEmpty prepend="AND" property="dpobCd" >
						   DPOB_CD = #dpobCd#
					  </isNotEmpty>
					UNION ALL
					SELECT DPOB_CD,
					       PAY_EXTPY_CD,
					       PYMT_DDUC_DIV_CD,
					       fcBass0300CDNM (#dpobCd#, PYMT_DDUC_DIV_CD)AS PYMT_DDUC_DIV_NM,
					       PAY_EXTPY_GRP_CD,
					       fcBass0300CDNM (#dpobCd#, PAY_EXTPY_GRP_CD)AS PAY_EXTPY_GRP_NM,
					       PAY_EXTPY_NM,
					       PAY_EXTPY_USE_YN,
					       0,
					       0,
					       PAY_EXTPY_USE_YN,
					       PAY_REVN_PSBY_YN,
					       ACC_ACC_CD,
					       SEVE_PAY_YN,
					       YRTX_FREE_DTY_REDU_CD,
					       PAYR_TERM_USE_YN,
					       SEVE_PAY_GRP_CD,
					       USALY_AMNT_YN,
					       YRTX_FREE_DTY_REDU_CD,
			               ACC_ACC_CD,
			               SEVE_PAY_YN
					  FROM PAYR0480
					  WHERE 1=1
					  <isNotEmpty prepend="AND" property="dpobCd" >
						   DPOB_CD = #dpobCd#
					  </isNotEmpty>
					  ORDER BY PAY_DDUC_CD ASC ) A
		<!--  WHERE A.PAY_DDUC_CD NOT IN (SELECT PAY_ITEM_CD FROM PAYR0485) -->
		  WHERE NOT EXISTS ( SELECT PAY_ITEM_CD 
		                       FROM PAYR0485 
		                     WHERE 1=1
			              		<isNotEmpty prepend="AND" property="dpobCd" >
				   					DPOB_CD = #dpobCd#
			  					</isNotEmpty>
			  					<isNotEmpty prepend="AND" property="emymtDivCd" >
				   					EMYMT_DIV_CD = #emymtDivCd#
			  					</isNotEmpty>
			  					 	AND PAY_ITEM_CD = A.PAY_DDUC_CD
		                      ) 
		  <isNotEmpty prepend="AND" property="dpobCd" >
			   A.DPOB_CD = #dpobCd#
		  </isNotEmpty>
		  
		  <isNotEmpty property="pymtDducDivCd" prepend="AND">
				A.PYMT_DDUC_DIV_CD = #pymtDducDivCd#
		  </isNotEmpty>
		  
		  <isNotEmpty property="dtilPayExtpyGrpCd" prepend="AND">
					  A.PAY_EXTPY_GRP_CD
				<iterate prepend="IN" property="dtilPayExtpyGrpCdArr" open="(" close=")" conjunction=",">
					 #dtilPayExtpyGrpCdArr[]#
				</iterate>
		  </isNotEmpty> 
	</select>
	
	
	<select id="bass5540DAO.selectBass5540ToPayr4450List_D" parameterClass="bass5540SrhVO" resultClass="egovMap">
	SELECT * FROM (
	SELECT A.*, ROWNUM RNUM FROM (
				SELECT
								  DPOB_CD
								, PAY_DDUC_CD 
								, PAY_DDUC_NM 
						FROM PAYR0470
				WHERE 1=1 
		      <isNotEmpty prepend="AND" property="dpobCd" >
			 	DPOB_CD=#dpobCd#
		      </isNotEmpty> 
		       <isNotEmpty prepend="AND" property="pymtDducDivCd" >
			 	PYMT_DDUC_DIV_CD=#pymtDducDivCd#
		      </isNotEmpty> 
					ORDER BY DPOB_CD ASC
							, PAY_DDUC_CD ASC
		
			<isNotEqual  property="lastIndex" compareValue="-1">
			 <![CDATA[					
				) A WHERE ROWNUM <= #lastIndex#
			)WHERE RNUM >= #firstIndex#
			]]>
			</isNotEqual>	
			<isEqual   property="lastIndex" compareValue="-1">
			  <![CDATA[					
				) A  
			)
			]]>
			</isEqual>
	</select>	
	
	<!-- 미사용 그룹 -->
	<select id="bass5540DAO.selectBass5540ToPayr0480List" parameterClass="bass5540SrhVO" resultClass="egovMap">
		SELECT A.* 
			FROM ( SELECT DPOB_CD,
					       PAY_DDUC_CD,
					       PYMT_DDUC_DIV_CD,
					       fcBass0300CDNM (#dpobCd#, PYMT_DDUC_DIV_CD)AS PYMT_DDUC_DIV_NM,
					       PAY_DDUC_GRP_CD AS PAY_EXTPY_GRP_CD,
					       fcBass0300CDNM (#dpobCd#, PAY_DDUC_GRP_CD)AS PAY_EXTPY_GRP_NM,
					       PAY_DDUC_NM,
					       PAY_DDUC_USE_YN,
					       PAY_DDUC_SUM,
					       PAY_DDUC_RTO,
					       '' AS TEMP1,
					       '' AS TEMP2,
					       YRTX_DDUC_DIV_CD,
					       GRP_APPTN_DIV_CD,
					       PAY_DDUC_BGNN_DT,
					       PAY_DDUC_END_DT,
					       PAYR_TERM_DDUC_YN,
					       '' AS TEMP,
					       '' AS YRTX_FREE_DTY_REDU_CD,
			               '' AS ACC_ACC_CD,
			               '' AS SEVE_PAY_YN
					  FROM PAYR0470
					  WHERE 1=1
					  <isNotEmpty prepend="AND" property="dpobCd" >
						   DPOB_CD = #dpobCd#
					  </isNotEmpty>
					UNION ALL
					SELECT DPOB_CD,
					       PAY_EXTPY_CD,
					       PYMT_DDUC_DIV_CD,
					       fcBass0300CDNM (#dpobCd#, PYMT_DDUC_DIV_CD)AS PYMT_DDUC_DIV_NM,
					       PAY_EXTPY_GRP_CD,
					       fcBass0300CDNM (#dpobCd#, PAY_EXTPY_GRP_CD)AS PAY_EXTPY_GRP_NM,
					       PAY_EXTPY_NM,
					       PAY_EXTPY_USE_YN,
					       0,
					       0,
					       PAY_EXTPY_USE_YN,
					       PAY_REVN_PSBY_YN,
					       ACC_ACC_CD,
					       SEVE_PAY_YN,
					       YRTX_FREE_DTY_REDU_CD,
					       PAYR_TERM_USE_YN,
					       SEVE_PAY_GRP_CD,
					       USALY_AMNT_YN,
					       YRTX_FREE_DTY_REDU_CD,
			               ACC_ACC_CD,
			               SEVE_PAY_YN
					  FROM PAYR0480
					  WHERE 1=1
					  <isNotEmpty prepend="AND" property="dpobCd" >
						   DPOB_CD = #dpobCd#
					  </isNotEmpty>
					  ORDER BY PAY_DDUC_CD ASC ) A
		<!--  WHERE A.PAY_DDUC_CD NOT IN (SELECT PAY_ITEM_CD FROM PAYR0485) -->
		  WHERE NOT EXISTS ( SELECT PAY_ITEM_CD 
		                       FROM PAYR0485 
		                     WHERE 1=1
			              		<isNotEmpty prepend="AND" property="dpobCd" >
				   					DPOB_CD = #dpobCd#
			  					</isNotEmpty>
			  					<isNotEmpty prepend="AND" property="emymtDivCd" >
				   					EMYMT_DIV_CD = #emymtDivCd#
			  					</isNotEmpty>
			  					 AND PAY_ITEM_CD = A.PAY_DDUC_CD
		                      )
		                      
		  <isNotEmpty prepend="AND" property="dpobCd" >
			   A.DPOB_CD = #dpobCd#
		  </isNotEmpty>
		  
		  <isNotEmpty property="pymtDducDivCd" prepend="AND">
				A.PYMT_DDUC_DIV_CD = #pymtDducDivCd#
		  </isNotEmpty>
		  
		  <isNotEmpty property="dtilPayExtpyGrpCd" prepend="AND">
					  A.PAY_EXTPY_GRP_CD
				<iterate prepend="IN" property="dtilPayExtpyGrpCdArr" open="(" close=")" conjunction=",">
					 #dtilPayExtpyGrpCdArr[]#
				</iterate>
		  </isNotEmpty> 		                      
	</select>
	
	<select id="bass5540DAO.selectBass5540ToPayr4450ListTotCnt_S" parameterClass="bass5540SrhVO" resultClass="int">
			SELECT COUNT(*) totcnt
			FROM PAYR0470
			WHERE 1=1 
		     <isNotEmpty prepend="AND" property="dpobCd" >
			 	DPOB_CD=#dpobCd#
		     </isNotEmpty> 
		        <isNotEmpty prepend="AND" property="pymtDducDivCd" >
			 	PYMT_DDUC_DIV_CD=#pymtDducDivCd#
		      </isNotEmpty> 
	</select>
	
	
	<!-- 지급공제구분에 따른 지급공제항목 가져오는 쿼리 -->
	<select id="bass5540DAO.selectBass5540AND480ToPayr4200List_D" parameterClass="bass5540SrhVO" resultClass="egovMap">
	SELECT *
	FROM (	SELECT
				DPOB_CD
				, PAY_DDUC_CD AS COMM_CD
				, PAY_DDUC_NM AS COMM_CD_NM
			FROM PAYR0470
			WHERE
				<isNotEmpty property="dpobCd">
					DPOB_CD=#dpobCd#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="pymtDducDivCd">
					PYMT_DDUC_DIV_CD=#pymtDducDivCd#
				</isNotEmpty>
			ORDER BY
				DPOB_CD ASC
				, PAY_DDUC_CD ASC
			)
	UNION ALL
	SELECT *
		FROM (	SELECT
            		DISTINCT DPOB_CD 
                	, PAY_EXTPY_CD AS COMM_CD
                	, PAY_EXTPY_NM AS COMM_CD_NM
        		FROM PAYR0480
        		WHERE 
	        		<isNotEmpty property="dpobCd">
						DPOB_CD=#dpobCd#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="pymtDducDivCd">
						PYMT_DDUC_DIV_CD=#pymtDducDivCd#
					</isNotEmpty>
            )  
	</select>

</sqlMap>
