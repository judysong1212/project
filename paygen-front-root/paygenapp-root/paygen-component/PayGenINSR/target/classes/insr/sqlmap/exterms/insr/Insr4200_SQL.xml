<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Insr4200">
	
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="insr4200SerarchVO" type="com.app.exterms.insurance.server.vo.Insr4200SrhVO"/>
	<typeAlias  alias="insr4200" type="com.app.exterms.insurance.server.vo.Insr4200VO"/>
	
	<resultMap id="insr4200" class="com.app.exterms.insurance.server.vo.Insr4200VO">
		<result property="dpobCd" column="DPOB_CD" columnIndex="1"/>
		<result property="systemkey" column="SYSTEMKEY" columnIndex="2"/>
		<result property="dducYrMnth" column="DDUC_YR_MNTH" columnIndex="3"/>
		<result property="emymtSeilNum" column="EMYMT_SEIL_NUM" columnIndex="4"/>
		<result property="hanNm" column="HAN_NM" columnIndex="5"/>
		<result property="resnRegnNum" column="RESN_REGN_NUM" columnIndex="6"/>
		<result property="regrstIncmTotAmnt" column="REGRST_INCM_TOT_AMNT" columnIndex="7"/>
		<result property="deinStdIncmMnthAmnt" column="DEIN_STD_INCM_MNTH_AMNT" columnIndex="8"/>
		<result property="deinMnthPrmm" column="DEIN_MNTH_PRMM" columnIndex="9"/>
		<result property="indvBrdnSum" column="INDV_BRDN_SUM" columnIndex="10"/>
		<result property="reattyQnty" column="REATTY_QNTY" columnIndex="11"/>
		<result property="hmlfClutPrmm" column="HMLF_CLUT_PRMM" columnIndex="12"/>
		<result property="hmlfPrmmAggr" column="HMLF_PRMM_AGGR" columnIndex="13"/>
		<result property="dpobBrdnSum" column="DPOB_BRDN_SUM" columnIndex="14"/>
		<result property="busoprClutPrmm" column="BUSOPR_CLUT_PRMM" columnIndex="15"/>
		<result property="busoprReattyPrmm" column="BUSOPR_REATTY_PRMM" columnIndex="16"/>
		<result property="busoprPrmmAggr" column="BUSOPR_PRMM_AGGR" columnIndex="17"/>
		<result property="aggr" column="AGGR" columnIndex="18"/>
		<result property="fluc" column="FLUC" columnIndex="19"/>
		<result property="aqtnMnthPymtYn" column="AQTN_MNTH_PYMT_YN" columnIndex="20"/>
		<result property="flucDt" column="FLUC_DT" columnIndex="21"/>
		<result property="flucReasCtnt" column="FLUC_REAS_CTNT" columnIndex="22"/>
		<result property="pbcorpOautyDeinYn" column="PBCORP_OAUTY_DEIN_YN" columnIndex="23"/>
		<result property="kybdr" column="KYBDR" columnIndex="24"/>
		<result property="inptDt" column="INPT_DT" columnIndex="25"/>
		<result property="inptAddr" column="INPT_ADDR" columnIndex="26"/>
		<result property="ismt" column="ISMT" columnIndex="27"/>
		<result property="revnDt" column="REVN_DT" columnIndex="28"/>
		<result property="revnAddr" column="REVN_ADDR" columnIndex="29"/>
		<result property="natPennSymNum" column="NAT_PENN_SYM_NUM" columnIndex="30"/>
		<result property="natPennPayCalcSum" column="NAT_PENN_PAY_CALC_SUM" columnIndex="31"/>
	</resultMap>
	
	<insert id="insr4200DAO.insertInsr4200_S">
		<![CDATA[
			INSERT INTO INSR4200 
				( DPOB_CD
				  , SYSTEMKEY
				  , DDUC_YR_MNTH
				  , EMYMT_SEIL_NUM
				  , HAN_NM
				  , RESN_REGN_NUM
				  , REGRST_INCM_TOT_AMNT
				  , DEIN_STD_INCM_MNTH_AMNT
				  , DEIN_MNTH_PRMM
				  , INDV_BRDN_SUM
				  , REATTY_QNTY
				  , HMLF_CLUT_PRMM
				  , HMLF_PRMM_AGGR
				  , DPOB_BRDN_SUM
				  , BUSOPR_CLUT_PRMM
				  , BUSOPR_REATTY_PRMM
				  , BUSOPR_PRMM_AGGR
				  , AGGR
				  , FLUC
				  , AQTN_MNTH_PYMT_YN
				  , FLUC_DT
				  , FLUC_REAS_CTNT
				  , PBCORP_OAUTY_DEIN_YN
				  , KYBDR
				  , INPT_DT
				  , INPT_ADDR
				  , ISMT
				  , REVN_DT
				  , REVN_ADDR )
			VALUES ( #dpobCd#
				  , #systemkey#
				  , #dducYrMnth#
				  , #emymtSeilNum#
				  , #hanNm#
				  , #resnRegnNum#
				  , #regrstIncmTotAmnt#
				  , #deinStdIncmMnthAmnt#
				  , #deinMnthPrmm#
				  , #indvBrdnSum#
				  , #reattyQnty#
				  , #hmlfClutPrmm#
				  , #hmlfPrmmAggr#
				  , #dpobBrdnSum#
				  , #busoprClutPrmm#
				  , #busoprReattyPrmm#
				  , #busoprPrmmAggr#
				  , #aggr#
				  , #fluc#
				  , #aqtnMnthPymtYn#
				  , #flucDt#
				  , #flucReasCtnt#
				  , #pbcorpOautyDeinYn#
				  , #kybdr#
				  , #inptDt#
				  , #inptAddr#
				  , #ismt#
				  , #revnDt#
				  , #revnAddr# )
		]]>
	</insert>
	
	<update id="insr4200DAO.updateInsr4200_S">
		<![CDATA[
			UPDATE INSR4200
			SET DPOB_CD=#dpobCd#
				, SYSTEMKEY=#systemkey#
				, DDUC_YR_MNTH=#dducYrMnth#
				, EMYMT_SEIL_NUM=#emymtSeilNum#
				, HAN_NM=#hanNm#
				, RESN_REGN_NUM=#resnRegnNum#
				, REGRST_INCM_TOT_AMNT=#regrstIncmTotAmnt#
				, DEIN_STD_INCM_MNTH_AMNT=#deinStdIncmMnthAmnt#
				, DEIN_MNTH_PRMM=#deinMnthPrmm#
				, INDV_BRDN_SUM=#indvBrdnSum#
				, REATTY_QNTY=#reattyQnty#
				, HMLF_CLUT_PRMM=#hmlfClutPrmm#
				, HMLF_PRMM_AGGR=#hmlfPrmmAggr#
				, DPOB_BRDN_SUM=#dpobBrdnSum#
				, BUSOPR_CLUT_PRMM=#busoprClutPrmm#
				, BUSOPR_REATTY_PRMM=#busoprReattyPrmm#
				, BUSOPR_PRMM_AGGR=#busoprPrmmAggr#
				, AGGR=#aggr#
				, FLUC=#fluc#
				, AQTN_MNTH_PYMT_YN=#aqtnMnthPymtYn#
				, FLUC_DT=#flucDt#
				, FLUC_REAS_CTNT=#flucReasCtnt#
				, PBCORP_OAUTY_DEIN_YN=#pbcorpOautyDeinYn#
				, KYBDR=#kybdr#
				, INPT_DT=#inptDt#
				, INPT_ADDR=#inptAddr#
				, ISMT=#ismt#
				, REVN_DT=#revnDt#
				, REVN_ADDR=#revnAddr#
						WHERE DPOB_CD=#dpobCd#
								AND SYSTEMKEY=#systemkey#
								AND DDUC_YR_MNTH=#dducYrMnth#
								AND EMYMT_SEIL_NUM=#emymtSeilNum#
				]]>
	</update>
	
	<delete id="insr4200DAO.deleteInsr4200_S">
		<![CDATA[
			DELETE FROM INSR4200 
						WHERE DPOB_CD=#dpobCd#
								AND SYSTEMKEY=#systemkey#
								AND DDUC_YR_MNTH=#dducYrMnth#
								AND EMYMT_SEIL_NUM=#emymtSeilNum#
				]]>
	</delete>
	
	<select id="insr4200DAO.selectInsr4200_S" resultMap="insr4200">
		<![CDATA[
			SELECT
				DPOB_CD
				, SYSTEMKEY
				, DDUC_YR_MNTH
				, EMYMT_SEIL_NUM
				, HAN_NM
				, RESN_REGN_NUM
				, REGRST_INCM_TOT_AMNT
				, DEIN_STD_INCM_MNTH_AMNT
				, DEIN_MNTH_PRMM
				, INDV_BRDN_SUM
				, REATTY_QNTY
				, HMLF_CLUT_PRMM
				, HMLF_PRMM_AGGR
				, DPOB_BRDN_SUM
				, BUSOPR_CLUT_PRMM
				, BUSOPR_REATTY_PRMM
				, BUSOPR_PRMM_AGGR
				, AGGR
				, FLUC
				, AQTN_MNTH_PYMT_YN
				, FLUC_DT
				, FLUC_REAS_CTNT
				, PBCORP_OAUTY_DEIN_YN
				, KYBDR
				, INPT_DT
				, INPT_ADDR
				, ISMT
				, REVN_DT
				, REVN_ADDR
			FROM INSR4200
						WHERE DPOB_CD=#dpobCd#
								AND SYSTEMKEY=#systemkey#
								AND DDUC_YR_MNTH=#dducYrMnth#
								AND EMYMT_SEIL_NUM=#emymtSeilNum#
				]]>
	</select>
	
	<select id="insr4200DAO.selectInsr4200List_D" parameterClass="insr4200SerarchVO" resultClass="egovMap">
SELECT * FROM (
	SELECT A.*, ROWNUM RNUM FROM (
				SELECT
								DPOB_CD
								, SYSTEMKEY
								, DDUC_YR_MNTH
								, EMYMT_SEIL_NUM
								, HAN_NM
								, RESN_REGN_NUM
								, REGRST_INCM_TOT_AMNT
								, DEIN_STD_INCM_MNTH_AMNT
								, DEIN_MNTH_PRMM
								, INDV_BRDN_SUM
								, REATTY_QNTY
								, HMLF_CLUT_PRMM
								, HMLF_PRMM_AGGR
								, DPOB_BRDN_SUM
								, BUSOPR_CLUT_PRMM
								, BUSOPR_REATTY_PRMM
								, BUSOPR_PRMM_AGGR
								, AGGR
								, FLUC
								, AQTN_MNTH_PYMT_YN
								, FLUC_DT
								, FLUC_REAS_CTNT
								, PBCORP_OAUTY_DEIN_YN
								, KYBDR
								, INPT_DT
								, INPT_ADDR
								, ISMT
								, REVN_DT
								, REVN_ADDR
						FROM INSR4200
				WHERE 1=1
				<isEqual prepend="AND" property="searchCondition" compareValue="0">
					DPOB_CD = #searchKeyword#
				</isEqual>
				<isEqual prepend="AND" property="searchCondition" compareValue="1">
					SYSTEMKEY LIKE '%' || #searchKeyword# || '%'
				</isEqual>
					ORDER BY 
						DPOB_CD DESC
							, SYSTEMKEY DESC
							, DDUC_YR_MNTH DESC
							, EMYMT_SEIL_NUM DESC
		
		<![CDATA[					
	) A WHERE ROWNUM <= #lastIndex#
)WHERE RNUM > #firstIndex#
]]>
	</select>	
	<select id="insr4200DAO.selectInsr4200ListTotCnt_S" parameterClass="insr4200SerarchVO" resultClass="int">
			SELECT COUNT(*) totcnt
			FROM INSR4200
			WHERE 1=1
			<isEqual prepend="AND" property="searchCondition" compareValue="0">
				DPOB_CD = #searchKeyword#
			</isEqual>
			<isEqual prepend="AND" property="searchCondition" compareValue="1">
				SYSTEMKEY LIKE '%' || #searchKeyword# || '%'
			</isEqual>
	</select>
	
	
	
	
	<!-- insr3150 국민연금 월별대사 -->
	<select id="insr4200DAO.selectInsr3150ToInsr4200ListTotCnt_S" parameterClass="insr4200SerarchVO" resultClass="int">
	    SELECT	COUNT(*) totcnt
		FROM	(
				SELECT	AA.DPOB_CD
							, AA.SYSTEMKEY
							, AA.DDUC_YR_MNTH
							, AA.EMYMT_SEIL_NUM
							, AA.HAN_NM
							, AA.RESN_REGN_NUM
							, AA.REGRST_INCM_TOT_AMNT
							, AA.DEIN_STD_INCM_MNTH_AMNT
							, AA.DEIN_MNTH_PRMM
							, AA.INDV_BRDN_SUM
							, AA.REATTY_QNTY
							, AA.HMLF_CLUT_PRMM
							, AA.HMLF_PRMM_AGGR
							, AA.DPOB_BRDN_SUM
							, AA.BUSOPR_CLUT_PRMM
							, AA.BUSOPR_REATTY_PRMM
							, AA.BUSOPR_PRMM_AGGR
							, AA.AGGR
							, AA.FLUC
							, AA.AQTN_MNTH_PYMT_YN
							, AA.FLUC_DT
							, AA.FLUC_REAS_CTNT
							, AA.PBCORP_OAUTY_DEIN_YN
							, AA.NAT_PAYR_DDUC_YR_MNTH
							, AA.NAT_INSR_PRCS_DT
							, AA.NAT_INSR_PRCS_YN
							, AA.NAT_INSR_PRMM_SRD
							, AA.DIVD_PYMT_DIV_CD
							, AA.DIVD_PYMT
							, BB.EMYMT_DIV_CD
							, fcBass0300CDNM(BB.DPOB_CD,BB.EMYMT_DIV_CD) AS EMYMT_DIV_NM 
							, BB.CURR_AFFN_DEPT_CD AS DEPT_CD
							, fcBass0400CDNM(BB.DPOB_CD,BB.CURR_AFFN_DEPT_CD,'2') AS DEPT_NM 
							, BB.TYP_OCCU_CD 
							,  fcBass0320CDNM(BB.DPOB_CD,BB.TYP_OCCU_CD)  AS TYP_OCCU_NM
							, BB.PYSP_GRDE_CD
							, BB.BUSIN_CD
							, fcBass0500CDNM(BB.DPOB_CD,SUBSTR(BB.EMYMT_BGNN_DT,1,4),BB.CURR_AFFN_DEPT_CD,BB.BUSIN_CD) AS BUSIN_NM 
				FROM 	INSR4200 AA, PSNL0100 BB, PAYR0500 CC 
				WHERE 	AA.DPOB_CD = BB.DPOB_CD 
				AND 		AA.SYSTEMKEY = BB.SYSTEMKEY
				AND 		AA.DPOB_CD = CC.DPOB_CD 
				AND 		AA.SYSTEMKEY = CC.SYSTEMKEY   
				<isNotEmpty prepend="AND" property="mangeDeptCd" >
							BB.DEPT_CD=#mangeDeptCd#
				</isNotEmpty> 
				<isNotEmpty prepend="AND" property="repbtyBusinDivCd" >
			         BB.REPBTY_BUSIN_DIV_CD=#repbtyBusinDivCd#
			    </isNotEmpty>
				<isNotEmpty prepend="AND" property="dpobCd" >
							AA.DPOB_CD=#dpobCd#
				</isNotEmpty> 
				<isNotEmpty prepend="AND" property="pymtYrMnth" >
							AA.DDUC_YR_MNTH = #pymtYrMnth#  
				</isNotEmpty>  
				AND EXISTS  (
							SELECT	C.DPOB_CD,
										C.DTIL_OCCU_INTTN_CD,
										C.TYP_OCCU_CD,
										C.DEPT_CD 
							FROM		( SELECT * 
                                                 FROM TABLE(PKG_DTIL_AUTH.FN_DTIL_AUTH_TB(#dpobCd#,#payrMangDeptYn#,#payrMangDeptCd#,#deptCd#,#usrId#,#deptCdAuth#,'' ))) C
							WHERE	C.DPOB_CD = BB.DPOB_CD
							AND 		C.DEPT_CD = BB.CURR_AFFN_DEPT_CD
							AND 		NVL(C.TYP_OCCU_CD,'TT')  = NVL(BB.TYP_OCCU_CD,'TT') 
							AND 		NVL(C.DTIL_OCCU_INTTN_CD,'TT')  = NVL(BB.DTIL_OCCU_INTTN_CD,'TT')
							<isNotEmpty property="deptCd" prepend="AND">
										C.DEPT_CD
								<iterate prepend="IN" property="deptCdArr" open="(" close=")" conjunction=",">
											#deptCdArr[]#
								</iterate>
							</isNotEmpty> 
				)       
				<isNotEmpty prepend="AND" property="businCd" >
							BB.BUSIN_CD=#businCd#
				</isNotEmpty> 
				<isNotEmpty property="typOccuCd" prepend="AND">
							BB.TYP_OCCU_CD
						<iterate prepend="IN" property="typOccuCdArr" open="(" close=")" conjunction=",">
								#typOccuCdArr[]#
						</iterate>
				</isNotEmpty>  
				<isNotEmpty property="dtilOccuInttnCd" prepend="AND">
							BB.DTIL_OCCU_INTTN_CD
					<iterate prepend="IN" property="dtilOccuInttnCdArr" open="(" close=")" conjunction=",">
								#dtilOccuInttnCdArr[]#
					</iterate>
				</isNotEmpty>  
				<isNotEmpty prepend="AND" property="systemkey" >
							AA.SYSTEMKEY=#systemkey#
				</isNotEmpty> 
				<isNotEmpty prepend="AND" property="hanNm" >
							BB.HAN_NM LIKE '%' || #hanNm# || '%'
				</isNotEmpty> 
				<isNotEmpty prepend="AND" property="payrMangeDeptCd" >
							CC.PAYR_MANG_DEPT_CD=#payrMangeDeptCd#
				</isNotEmpty> 
				<isNotEmpty property="hdofcCodtnCd" prepend="AND">
							BB.HDOFC_CODTN_CD
						<iterate prepend="IN" property="hdofcCodtnCdArr" open="(" close=")" conjunction=",">
								#hdofcCodtnCdArr[]#
						</iterate>
				</isNotEmpty> 
				<isNotEmpty prepend="AND" property="emymtDivCd" >
							BB.EMYMT_DIV_CD=#emymtDivCd#
				</isNotEmpty>  
				<isNotEmpty prepend="AND" property="businApptnYr" >
							SUBSTR(BB.EMYMT_BGNN_DT,1,4) =#businApptnYr#
				</isNotEmpty>  
		)
	</select>
	
	<!-- insr3150 국민연금 월별대사 -->
	<select id="insr4200DAO.selectInsr3150ToInsr4200List_D" parameterClass="insr4200SerarchVO" resultClass="egovMap">
	    SELECT	* 
	    FROM 	(
					SELECT	A.*, ROWNUM RNUM 
					FROM 	(
						SELECT		    AA.DDUC_YR_MNTH ,
							            fcBass0400CDNM(BB.DPOB_CD,BB.CURR_AFFN_DEPT_CD,'2') AS DEPT_NM ,
							            NVL(AA.HAN_NM, BB.HAN_NM) AS HAN_NM ,
							            AA.RESN_REGN_NUM ,
							            AA.NAT_PAYR_DDUC_YR_MNTH ,         
							            AA.NAT_INSR_PRCS_YN ,         
							            DD.NAT_PENN_STD_INCM_MNTH_AMNT,
							            AA.NAT_PENN_SYM_NUM ,
							            AA.NAT_PENN_PAY_CALC_SUM,
							            NVL(AA.AGGR,0)                    AS AGGR ,
							            ( NVL(AGGR,0) - NVL(NAT_PENN_PAY_CALC_SUM,0) )AS NAT_INSR_PRMM_SRD,
							  			AA.DPOB_CD ,
							            AA.SYSTEMKEY ,
							            AA.EMYMT_SEIL_NUM ,
							            NVL(AA.REGRST_INCM_TOT_AMNT,0)    AS REGRST_INCM_TOT_AMNT ,
							            NVL(AA.DEIN_STD_INCM_MNTH_AMNT,0) AS DEIN_STD_INCM_MNTH_AMNT ,
							            NVL(AA.DEIN_MNTH_PRMM,0)          AS DEIN_MNTH_PRMM ,
							            NVL(AA.INDV_BRDN_SUM,0)           AS INDV_BRDN_SUM ,
							            NVL(AA.REATTY_QNTY,0)             AS REATTY_QNTY ,
							            NVL(AA.HMLF_CLUT_PRMM,0)          AS HMLF_CLUT_PRMM ,
							            NVL(AA.HMLF_PRMM_AGGR,0)          AS HMLF_PRMM_AGGR ,
							            NVL(AA.DPOB_BRDN_SUM,0)           AS DPOB_BRDN_SUM ,
							            NVL(AA.BUSOPR_CLUT_PRMM,0)        AS BUSOPR_CLUT_PRMM ,
							            NVL(AA.BUSOPR_REATTY_PRMM,0)      AS BUSOPR_REATTY_PRMM ,
							            NVL(AA.BUSOPR_PRMM_AGGR,0)        AS BUSOPR_PRMM_AGGR ,
							            AA.FLUC ,
							            AA.AQTN_MNTH_PYMT_YN ,
							            AA.FLUC_DT ,
							            AA.FLUC_REAS_CTNT ,
							            AA.PBCORP_OAUTY_DEIN_YN ,
							            AA.NAT_INSR_PRCS_DT ,
							            AA.DIVD_PYMT_DIV_CD ,
							            AA.DIVD_PYMT ,
							            BB.EMYMT_DIV_CD ,
							            fcBass0300CDNM(BB.DPOB_CD,BB.EMYMT_DIV_CD)          AS EMYMT_DIV_NM ,
							            BB.CURR_AFFN_DEPT_CD                                AS DEPT_CD ,
							            BB.TYP_OCCU_CD ,
							            fcBass0320CDNM(BB.DPOB_CD,BB.TYP_OCCU_CD) AS TYP_OCCU_NM ,
							            BB.PYSP_GRDE_CD ,
      								    BB.BUSIN_CD,
									    fcBass0500CDNM(BB.DPOB_CD,SUBSTR(BB.EMYMT_BGNN_DT,1,4),BB.CURR_AFFN_DEPT_CD,BB.BUSIN_CD) AS BUSIN_NM 
						FROM 	INSR4200 AA, PSNL0100 BB, PAYR0500 CC , PSNL0127 DD 
						WHERE 	AA.DPOB_CD = BB.DPOB_CD 
						AND 		AA.SYSTEMKEY = BB.SYSTEMKEY
						AND 		AA.DPOB_CD = CC.DPOB_CD 
						AND 		AA.SYSTEMKEY = CC.SYSTEMKEY  
						AND 		AA.DPOB_CD = DD.DPOB_CD 
						AND 		AA.SYSTEMKEY = DD.SYSTEMKEY  
						<isNotEmpty prepend="AND" property="mangeDeptCd" >
							BB.DEPT_CD=#mangeDeptCd#
						</isNotEmpty> 
						<isNotEmpty prepend="AND" property="repbtyBusinDivCd" >
					         BB.REPBTY_BUSIN_DIV_CD=#repbtyBusinDivCd#
					    </isNotEmpty>
						<isNotEmpty prepend="AND" property="dpobCd" >
									AA.DPOB_CD=#dpobCd#
						</isNotEmpty> 
						<isNotEmpty prepend="AND" property="pymtYrMnth" >
									AA.DDUC_YR_MNTH = #pymtYrMnth#  
						</isNotEmpty>  
						AND EXISTS  (
									SELECT	C.DPOB_CD,
												C.DTIL_OCCU_INTTN_CD,
												C.TYP_OCCU_CD,
												C.DEPT_CD 
									FROM		( SELECT * 
                                                 FROM TABLE(PKG_DTIL_AUTH.FN_DTIL_AUTH_TB(#dpobCd#,#payrMangDeptYn#,#payrMangDeptCd#,#deptCd#,#usrId#,#deptCdAuth#,'' ))) C
									WHERE	C.DPOB_CD = BB.DPOB_CD
									AND 		C.DEPT_CD = BB.CURR_AFFN_DEPT_CD
									AND 		NVL(C.TYP_OCCU_CD,'TT')  = NVL(BB.TYP_OCCU_CD,'TT') 
									AND 		NVL(C.DTIL_OCCU_INTTN_CD,'TT')  = NVL(BB.DTIL_OCCU_INTTN_CD,'TT')
									<isNotEmpty property="deptCd" prepend="AND">
												C.DEPT_CD
										<iterate prepend="IN" property="deptCdArr" open="(" close=")" conjunction=",">
													#deptCdArr[]#
										</iterate>
									</isNotEmpty> 
						)       
						<isNotEmpty prepend="AND" property="businCd" >
									BB.BUSIN_CD=#businCd#
						</isNotEmpty> 
						<isNotEmpty property="typOccuCd" prepend="AND">
									BB.TYP_OCCU_CD
								<iterate prepend="IN" property="typOccuCdArr" open="(" close=")" conjunction=",">
										#typOccuCdArr[]#
								</iterate>
						</isNotEmpty>  
						<isNotEmpty property="dtilOccuInttnCd" prepend="AND">
									BB.DTIL_OCCU_INTTN_CD
							<iterate prepend="IN" property="dtilOccuInttnCdArr" open="(" close=")" conjunction=",">
										#dtilOccuInttnCdArr[]#
							</iterate>
						</isNotEmpty>  
						<isNotEmpty prepend="AND" property="systemkey" >
									AA.SYSTEMKEY=#systemkey#
						</isNotEmpty> 
						<isNotEmpty prepend="AND" property="hanNm" >
									BB.HAN_NM LIKE '%' || #hanNm# || '%'
						</isNotEmpty> 
						<isNotEmpty prepend="AND" property="payrMangeDeptCd" >
									CC.PAYR_MANG_DEPT_CD=#payrMangeDeptCd#
						</isNotEmpty> 
						<isNotEmpty property="hdofcCodtnCd" prepend="AND">
									BB.HDOFC_CODTN_CD
								<iterate prepend="IN" property="hdofcCodtnCdArr" open="(" close=")" conjunction=",">
										#hdofcCodtnCdArr[]#
								</iterate>
						</isNotEmpty> 
						<isNotEmpty prepend="AND" property="emymtDivCd" >
									BB.EMYMT_DIV_CD=#emymtDivCd#
						</isNotEmpty>  
						<isNotEmpty prepend="AND" property="businApptnYr" >
									SUBSTR(BB.EMYMT_BGNN_DT,1,4) =#businApptnYr#
						</isNotEmpty>  
						ORDER BY	AA.DPOB_CD ASC
										, (SELECT	LPAD(DEPT_RANK,5,'0') FROM BASS0400 DD WHERE DD.DEPT_CD = BB.CURR_AFFN_DEPT_CD AND DD.DPOB_CD = BB.DPOB_CD) ASC 
										, AA.RESN_REGN_NUM ASC  
						                , BB.DTIL_OCCU_CLS_DIV_CD ASC 
						<![CDATA[					
					) A 
					WHERE ROWNUM <= #lastIndex#
			) WHERE RNUM >= #firstIndex#
			]]>
	</select>	

	<!-- insr3150 국민연금 월별대사 엑셀-->
	<select id="insr4200DAO.selectXlsInsr3150ToInsr4200List_D" parameterClass="insr4200SerarchVO" resultClass="egovMap">
	    
					SELECT	A.*, ROWNUM RNUM 
					FROM 	(
						SELECT	AA.DPOB_CD
									, AA.SYSTEMKEY
									, AA.DDUC_YR_MNTH
									, AA.EMYMT_SEIL_NUM
									, NVL(AA.HAN_NM,BB.HAN_NM) AS HAN_NM 
									, AA.RESN_REGN_NUM
									, AA.REGRST_INCM_TOT_AMNT
									, AA.DEIN_STD_INCM_MNTH_AMNT
									, AA.DEIN_MNTH_PRMM
									, AA.INDV_BRDN_SUM
									, AA.REATTY_QNTY
									, AA.HMLF_CLUT_PRMM
									, AA.HMLF_PRMM_AGGR
									, AA.DPOB_BRDN_SUM
									, AA.BUSOPR_CLUT_PRMM
									, AA.BUSOPR_REATTY_PRMM
									, AA.BUSOPR_PRMM_AGGR
									, AA.AGGR
									, AA.FLUC
									, AA.AQTN_MNTH_PYMT_YN
									, AA.FLUC_DT
									, AA.FLUC_REAS_CTNT
									, AA.PBCORP_OAUTY_DEIN_YN
									, AA.NAT_PAYR_DDUC_YR_MNTH
									, AA.NAT_INSR_PRCS_DT
									, AA.NAT_INSR_PRCS_YN
									, AA.NAT_INSR_PRMM_SRD
									, AA.DIVD_PYMT_DIV_CD
									, AA.DIVD_PYMT
									, BB.EMYMT_DIV_CD
									, fcBass0300CDNM(BB.DPOB_CD,BB.EMYMT_DIV_CD) AS EMYMT_DIV_NM 
									, BB.CURR_AFFN_DEPT_CD AS DEPT_CD
									, fcBass0400CDNM(BB.DPOB_CD,BB.CURR_AFFN_DEPT_CD,'2') AS DEPT_NM 
									, BB.TYP_OCCU_CD 
									,  fcBass0320CDNM(BB.DPOB_CD,BB.TYP_OCCU_CD)  AS TYP_OCCU_NM
									, BB.PYSP_GRDE_CD
									, BB.BUSIN_CD
									, fcBass0500CDNM(BB.DPOB_CD,SUBSTR(BB.EMYMT_BGNN_DT,1,4),BB.CURR_AFFN_DEPT_CD,BB.BUSIN_CD) AS BUSIN_NM 
									, AA.NAT_PENN_SYM_NUM
									, AA.NAT_PENN_PAY_CALC_SUM
						FROM 	INSR4200 AA, PSNL0100 BB, PAYR0500 CC 
						WHERE 	AA.DPOB_CD = BB.DPOB_CD 
						AND 		AA.SYSTEMKEY = BB.SYSTEMKEY
						AND 		AA.DPOB_CD = CC.DPOB_CD 
						AND 		AA.SYSTEMKEY = CC.SYSTEMKEY   
						<isNotEmpty prepend="AND" property="mangeDeptCd" >
									BB.DEPT_CD=#mangeDeptCd#
						</isNotEmpty> 
						<isNotEmpty prepend="AND" property="repbtyBusinDivCd" >
				         			BB.REPBTY_BUSIN_DIV_CD=#repbtyBusinDivCd#
				        </isNotEmpty> 
						<isNotEmpty prepend="AND" property="dpobCd" >
									AA.DPOB_CD=#dpobCd#
						</isNotEmpty> 
						<isNotEmpty prepend="AND" property="pymtYrMnth" >
									AA.DDUC_YR_MNTH = #pymtYrMnth#  
						</isNotEmpty>  
						AND EXISTS  (
									SELECT	C.DPOB_CD,
												C.DTIL_OCCU_INTTN_CD,
												C.TYP_OCCU_CD,
												C.DEPT_CD 
									FROM		(
												 SELECT * 
                                                 FROM TABLE(PKG_DTIL_AUTH.FN_DTIL_AUTH_TB(#dpobCd#,#payrMangDeptYn#,#payrMangDeptCd#,#deptCd#,#usrId#,#deptCdAuth#,'' ))) C
									WHERE	C.DPOB_CD = BB.DPOB_CD
									AND 		C.DEPT_CD = BB.CURR_AFFN_DEPT_CD
									AND 		NVL(C.TYP_OCCU_CD,'TT')  = NVL(BB.TYP_OCCU_CD,'TT') 
									AND 		NVL(C.DTIL_OCCU_INTTN_CD,'TT')  = NVL(BB.DTIL_OCCU_INTTN_CD,'TT')
									<isNotEmpty property="deptCd" prepend="AND">
												C.DEPT_CD
										<iterate prepend="IN" property="deptCdArr" open="(" close=")" conjunction=",">
													#deptCdArr[]#
										</iterate>
									</isNotEmpty> 
						)       
						<isNotEmpty prepend="AND" property="businCd" >
									BB.BUSIN_CD=#businCd#
						</isNotEmpty> 
						<isNotEmpty property="typOccuCd" prepend="AND">
									BB.TYP_OCCU_CD
								<iterate prepend="IN" property="typOccuCdArr" open="(" close=")" conjunction=",">
										#typOccuCdArr[]#
								</iterate>
						</isNotEmpty>  
						<isNotEmpty property="dtilOccuInttnCd" prepend="AND">
									BB.DTIL_OCCU_INTTN_CD
							<iterate prepend="IN" property="dtilOccuInttnCdArr" open="(" close=")" conjunction=",">
										#dtilOccuInttnCdArr[]#
							</iterate>
						</isNotEmpty>  
						<isNotEmpty prepend="AND" property="systemkey" >
									AA.SYSTEMKEY=#systemkey#
						</isNotEmpty> 
						<isNotEmpty prepend="AND" property="hanNm" >
									BB.HAN_NM LIKE '%' || #hanNm# || '%'
						</isNotEmpty> 
						<isNotEmpty prepend="AND" property="payrMangeDeptCd" >
									CC.PAYR_MANG_DEPT_CD=#payrMangeDeptCd#
						</isNotEmpty> 
						<isNotEmpty property="hdofcCodtnCd" prepend="AND">
									BB.HDOFC_CODTN_CD
								<iterate prepend="IN" property="hdofcCodtnCdArr" open="(" close=")" conjunction=",">
										#hdofcCodtnCdArr[]#
								</iterate>
						</isNotEmpty> 
						<isNotEmpty prepend="AND" property="emymtDivCd" >
									BB.EMYMT_DIV_CD=#emymtDivCd#
						</isNotEmpty>  
						<isNotEmpty prepend="AND" property="businApptnYr" >
									SUBSTR(BB.EMYMT_BGNN_DT,1,4) =#businApptnYr#
						</isNotEmpty>  
						ORDER BY	AA.DPOB_CD ASC
										, (SELECT	LPAD(DEPT_RANK,5,'0') FROM BASS0400 DD WHERE DD.DEPT_CD = BB.CURR_AFFN_DEPT_CD AND DD.DPOB_CD = BB.DPOB_CD) ASC 
										, AA.RESN_REGN_NUM ASC  
						                , BB.DTIL_OCCU_CLS_DIV_CD ASC 
						<![CDATA[					
					) A 
					
			]]>
	</select>	
	
	<delete id="insr4200DAO.deleteXlsInsr4200_S">
		<![CDATA[
			DELETE FROM INSR4200 
						WHERE DPOB_CD=#dpobCd# 
						  AND DDUC_YR_MNTH=#dducYrMnth#
						  AND SYSTEMKEY= (SELECT SYSTEMKEY 
						                    FROM PSNL0100
						                    WHERE  DPOB_CD=#dpobCd#
	                                          AND  RESN_REGN_NUM = Replace(#resnRegnNum#,'-','')  
						               ) 
				]]>
	</delete>
	
	<insert id="insr4200DAO.insertXlsInsr4200_S">
		<![CDATA[
			INSERT INTO INSR4200 (
											DPOB_CD
											, SYSTEMKEY
											, EMYMT_SEIL_NUM
											, DDUC_YR_MNTH
											, HAN_NM
											, RESN_REGN_NUM
											, REGRST_INCM_TOT_AMNT
											, DEIN_STD_INCM_MNTH_AMNT
											, DEIN_MNTH_PRMM
											, INDV_BRDN_SUM
											, REATTY_QNTY
											, HMLF_CLUT_PRMM
											, HMLF_PRMM_AGGR
											, DPOB_BRDN_SUM
											, BUSOPR_CLUT_PRMM
											, BUSOPR_REATTY_PRMM
											, BUSOPR_PRMM_AGGR
											, AGGR, FLUC
											, AQTN_MNTH_PYMT_YN
											, FLUC_DT
											, FLUC_REAS_CTNT
											, PBCORP_OAUTY_DEIN_YN
											, KYBDR
											, INPT_DT
											, INPT_ADDR
											, ISMT
											, REVN_DT
											, REVN_ADDR
											, NAT_PAYR_DDUC_YR_MNTH
											, NAT_INSR_PRCS_DT
											, NAT_INSR_PRCS_YN
											, NAT_INSR_PRMM_SRD
											, DIVD_PYMT_DIV_CD
											, DIVD_PYMT
											, NAT_PENN_SYM_NUM
											, NAT_PENN_PAY_CALC_SUM
											) 
			VALUES (
						#dpobCd#
				  		, NVL( (SELECT	SYSTEMKEY FROM PSNL0100 WHERE  DPOB_CD=#dpobCd# AND RESN_REGN_NUM = Replace(#resnRegnNum#,'-','')),( 'P' || LPAD((SELECT NVL(MAX(EMYMT_SEIL_NUM),0) + 1 FROM INSR4300),7,'0')))   
						, ( SELECT MAX(EMYMT_SEIL_NUM) AS EMYMT_SEIL_NUM FROM INSR3000 WHERE DPOB_CD = #dpobCd# AND SYSTEMKEY= ( SELECT SYSTEMKEY FROM PSNL0100 WHERE DPOB_CD = #dpobCd# AND RESN_REGN_NUM = REPLACE(#resnRegnNum#,'-','') ) )
						, #dducYrMnth#
						, #hanNm#
						, Replace(#resnRegnNum#,'-','')
						, #regrstIncmTotAmnt#
						, #deinStdIncmMnthAmnt#
						, #deinMnthPrmm#
						, #indvBrdnSum#
						, #reattyQnty#
						, #hmlfClutPrmm#
						,  ( SELECT CASE
							  WHEN (  NVL(#indvBrdnSum#,0) +  NVL(#reattyQnty#,0) + NVL(#hmlfClutPrmm#,0)  ) <= 0
							   THEN  0 
							  ELSE (  NVL(#indvBrdnSum#,0) +  NVL(#reattyQnty#,0) + NVL(#hmlfClutPrmm#,0)  ) END FROM DUAL 
						)
						, #dpobBrdnSum#
						, #busoprClutPrmm#
						, #busoprReattyPrmm#
						, ( SELECT CASE
							  WHEN (  NVL(#dpobBrdnSum#,0) +  NVL(#busoprClutPrmm#,0) + NVL(#busoprReattyPrmm#,0)  ) <= 0
							   THEN  0 
							  ELSE (   NVL(#dpobBrdnSum#,0) +  NVL(#busoprClutPrmm#,0) + NVL(#busoprReattyPrmm#,0)   ) END FROM DUAL 
						)
						, #aggr#
						, #fluc#
						, #aqtnMnthPymtYn#
						, #flucDt#
						, #flucReasCtnt#
						, #pbcorpOautyDeinYn#
						, #kybdr#
						, TO_CHAR(SYSDATE,'YYYYMMDD')
						, #inptAddr#
						, #ismt#
						, TO_CHAR(SYSDATE,'YYYYMMDD')
						, #revnAddr#
						, #dducYrMnth#
						, TO_CHAR(SYSDATE,'YYYYMMDD')
						, #natInsrPrcsYn#
						, NVL( #aggr# ,0) 
						, #divdPymtDivCd#
						, #divdPymt#
						, #natPennSymNum#
						,  (
							SELECT	 NVL (SUM (PYMT_DDUC_SUM), 0) 
													    FROM 	PAYR0302 AAA
														WHERE 	SYSTEMKEY = (
																		NVL( (SELECT	SYSTEMKEY FROM PSNL0100 WHERE  DPOB_CD=#dpobCd# AND RESN_REGN_NUM = Replace(#resnRegnNum#,'-','')),( 'P' || LPAD((SELECT NVL(MAX(EMYMT_SEIL_NUM),0) + 1 FROM INSR4300),7,'0')))
														)
														AND 		PAY_CD='B0150000' 
														AND 		PAY_ITEM_CD IN ('D0150100', 'D0150300', 'D0150200')
														AND		PYMT_YR_MNTH = #dducYrMnth#
							              AND  EXISTS(
							                  SELECT *
							                  FROM   PAYR0301  BBB
							                  WHERE  BBB.PAY_CD = AAA.PAY_CD
							                  AND    BBB.PYMT_YR_MNTH = AAA.PYMT_YR_MNTH
							                  AND    BBB.PAYR_SEIL_NUM = AAA.PAYR_SEIL_NUM
							                  AND    BBB.SYSTEMKEY = AAA.SYSTEMKEY
							                  AND    BBB.PAY_DDLNE_YN = 'Y'
							            )   
							 )
					 )					
		]]>
	</insert>
	
	<update id="insr4200DAO.insr3150MnthUpdate_S">
			UPDATE INSR4200
			SET 
				<isEqual property="natPayrDducYrMnth" compareValue="This">
						NAT_PAYR_DDUC_YR_MNTH = #dducYrMnth#
						, NAT_INSR_PRCS_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
						,NAT_INSR_PRMM_SRD = NVL(#natInsrPrmmSrd#,0)
				</isEqual>
				<isEqual property="natPayrDducYrMnth" compareValue="Next">
						NAT_PAYR_DDUC_YR_MNTH = TO_CHAR(ADD_MONTHS(TO_DATE(#dducYrMnth#,'YYYYMM'), 1), 'YYYYMM')
						, NAT_INSR_PRCS_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
						,NAT_INSR_PRMM_SRD = NVL(#natInsrPrmmSrd#,0)
				</isEqual>
				<isEqual property="natPayrDducYrMnth" compareValue="Cancel">
						NAT_PAYR_DDUC_YR_MNTH =  NULL
						, NAT_INSR_PRCS_DT = NULL
						,NAT_INSR_PRMM_SRD = NVL(#natInsrPrmmSrd#,0)
				</isEqual>
				<isEqual property="natPayrDducYrMnth" compareValue="Pay">
						NAT_PENN_PAY_CALC_SUM =  ( SELECT	NVL (SUM (PYMT_DDUC_SUM), 0) 
						    FROM 	PAYR0302 
							WHERE 	SYSTEMKEY = #systemkey#
							AND 		PAY_CD='B0150000' 
							AND 		PAY_ITEM_CD IN ('D0150100', 'D0150300', 'D0150200')
							AND		PYMT_YR_MNTH = #dducYrMnth# 
						)
						,NAT_INSR_PRMM_SRD = NVL(#natInsrPrmmSrd#,0)
				</isEqual>
				, ISMT=#ismt#
				, REVN_DT=TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')
				, REVN_ADDR=#revnAddr#
			WHERE DPOB_CD=#dpobCd#
			AND SYSTEMKEY=#systemkey#
			AND EMYMT_SEIL_NUM=#emymtSeilNum#
			AND DDUC_YR_MNTH = #dducYrMnth#
	</update>
	
		<!-- Insr4200 건강보험 등록자인지 확인  -->
	<select id="insr4200DAO.selectInsr4200RegChkCnt" parameterClass="insr4200" resultClass="int">
			SELECT COUNT(*) totcnt
			FROM   INSR4100
			WHERE  1=1
			AND    SYSTEMKEY = (
				      SELECT SYSTEMKEY
				      FROM   PSNL0100
				      WHERE  1=1 
				      AND    RESN_REGN_NUM = REPLACE(#resnRegnNum#, '-', '')
				     <!--  AND    HDOFC_CODTN_CD IN( 'A0030010' ) --> <!-- 재직자 체크 -->
				      AND    ROWNUM = 1 
			)
	</select>
	
			<!-- 대사월 급여마감여부 체크  -->
	<select id="insr4200DAO.selectPayCloseChkCnt" parameterClass="insr4200" resultClass="int">
             <![CDATA[
             	  SELECT NVL(COUNT(*),0) CNT
               FROM   PAYR0301  BBB
               WHERE  BBB.PAY_CD = 'B0150000' 
               AND    BBB.PYMT_YR_MNTH =  #dducYrMnth#
               AND    BBB.SYSTEMKEY =  #systemkey#
               AND    BBB.PAY_DDLNE_YN = 'Y'
               	]]>
	</select>
	

	
</sqlMap>
