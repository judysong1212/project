<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
 
<sqlMap namespace="Psnl0132"> 
	<typeAlias alias="hashMap" type="java.util.HashMap"/>
    <typeAlias alias="list" type="java.util.List"/>
	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	
	<typeAlias alias="psnl0132Dto" type="com.app.exterms.personal.client.dto.Psnl0132DTO"/>
	<typeAlias alias="psnl0132SrhVo" type="com.app.exterms.personal.server.vo.Psnl0132SrhVO"/>
	<typeAlias alias="psnl0132Vo" type="com.app.exterms.personal.server.vo.Psnl0132VO" />
	
	<resultMap id="psnl0132VoMap" class="com.app.exterms.personal.server.vo.Psnl0132VO"> 
		<result property="refeFlSeilNum"	column="REFE_FL_SEIL_NUM"	columnIndex="1"/>
		<result property="dpobCd" 			column="DPOB_CD" 			columnIndex="2"/>
		<result property="systemkey" 		column="SYSTEMKEY" 			columnIndex="3"/>
		<result property="refeSeilNum" 		column="REFE_SEIL_NUM" 		columnIndex="4"/> 
		<result property="refeFlnm" 		column="REFE_FLNM" 			columnIndex="5"/>
		<result property="refeOrgFlnm" 		column="REFE_ORG_FLNM" 		columnIndex="6"/>
		<result property="refeFlcos" 		column="REFE_FLCOS" 		columnIndex="7"/>
		<result property="refeFlsz" 		column="REFE_FLSZ" 			columnIndex="8"/>
		<result property="kybdr" 			column="KYBDR" 				columnIndex="9"/>
		<result property="inptDt" 			column="INPT_DT" 			columnIndex="10"/> 
		<result property="inptAddr" 		column="INPT_ADDR" 			columnIndex="11"/> 
		<result property="ismt" 			column="ISMT" 				columnIndex="12"/>
		<result property="revnDt" 			column="REVN_DT" 			columnIndex="13"/>
		<result property="revnAddr" 		column="REVN_ADDR" 			columnIndex="14"/>
	</resultMap>
	
	
	<!-- 관련근거 파일 조회 resultMap으로 가져옴.  -->
	<select id="psnl0132DAO.selectPsnl0132Map" resultMap="psnl0132VoMap" parameterClass="psnl0132SrhVo"> 
	<![CDATA[
		SELECT REFE_FL_SEIL_NUM    
				, DPOB_CD                
				, SYSTEMKEY            
				, REFE_SEIL_NUM        
				, REFE_FLNM            
				, REFE_ORG_FLNM        
				, REFE_FLCOS            
				, REFE_FLSZ            
				, KYBDR                
				, INPT_DT                
				, INPT_ADDR            
				, ISMT                
				, REVN_DT                
				, REVN_ADDR  
		  FROM PSNL0132
		WHERE  DPOB_CD = #dpobCd#
		    AND SYSTEMKEY = #systemkey#
		    AND REFE_SEIL_NUM = #refeSeilNum# 
		    AND REFE_FL_SEIL_NUM = #refeFlSeilNum#   
	]]>	 
	</select>
	
	<!-- 관련근거 파일 조회  -->
	<select id="psnl0132DAO.selectPsnl0132" resultClass="egovMap" parameterClass="psnl0132SrhVo"> 
	<![CDATA[
		SELECT REFE_FL_SEIL_NUM    
				, DPOB_CD                
				, SYSTEMKEY            
				, REFE_SEIL_NUM        
				, REFE_FLNM            
				, REFE_ORG_FLNM        
				, REFE_FLCOS            
				, REFE_FLSZ            
				, KYBDR                
				, INPT_DT                
				, INPT_ADDR            
				, ISMT                
				, REVN_DT                
				, REVN_ADDR  
		  FROM PSNL0132
		WHERE  DPOB_CD = #dpobCd#
		    AND SYSTEMKEY = #systemkey#
		    AND REFE_SEIL_NUM = #refeSeilNum#    
		ORDER BY REFE_FL_SEIL_NUM       
	]]>	 
	</select>
	
	
	<!-- 관련근거파일 저장  -->
	<insert id="psnl0132DAO.insertPsnl0132" parameterClass="psnl0132Vo">
		<![CDATA[
			INSERT INTO PSNL0132 
					( REFE_FL_SEIL_NUM
						, DPOB_CD			
						, SYSTEMKEY		
						, REFE_SEIL_NUM	
						, REFE_FLNM		
						, REFE_ORG_FLNM	
						, REFE_FLCOS		
						, REFE_FLSZ		
						, KYBDR			
						, INPT_DT			
						, INPT_ADDR		
						, ISMT			
						, REVN_DT			
						, REVN_ADDR			  )
					VALUES ( ( SELECT LPAD(NVL(MAX(REFE_FL_SEIL_NUM), 0) + 1 , 4 , '0')
									FROM PSNL0132 
								   WHERE DPOB_CD = #dpobCd# 
									AND SYSTEMKEY = #systemkey#   
								   )
							, #dpobCd#			
							, #systemkey#		
							, #refeSeilNum#	
							, TO_CHAR(SYSDATE, 'yyyyMMddhhmiss') ||  ( SELECT LPAD(NVL(MAX(REFE_FL_SEIL_NUM), 0) + 1 , 4 , '0')
																		FROM PSNL0132 
																	   WHERE DPOB_CD = #dpobCd# 
																		AND SYSTEMKEY = #systemkey#   
																	   ) 		
							, #refeOrgFlnm#	
							, #refeFlcos#		
							, #refeFlsz#		
							, #kybdr#			
							, TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')			
							, #inptAddr#		
							, #ismt#			
							, TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')			
							, #revnAddr#	
					    )
				]]>	    
	</insert>
	
	
	<!-- 관련근거파일 수정 , REFE_FLCOS = 	#refeFlcos# -->
	<update id="psnl0132DAO.updatePsnl0132" parameterClass="psnl0132Vo">
		<![CDATA[
			UPDATE PSNL0132
			  SET  ISMT = #ismt#			
				, REVN_DT = TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')  			
				, REVN_ADDR	=  #revnAddr#	
		]]>
				, REFE_FLNM	= TO_CHAR(SYSDATE, 'yyyyMMddhhmiss') || #refeFlSeilNum#
				, REFE_ORG_FLNM	=#refeOrgFlnm#
			WHERE DPOB_CD=#dpobCd#
				AND SYSTEMKEY=#systemkey#
				AND REFE_SEIL_NUM=#refeSeilNum#
				AND REFE_FL_SEIL_NUM = #refeFlSeilNum#
	</update>
	
	<!-- 파일 업로드 후 파일 크기 update 처리 -->
	<update id="psnl0132DAO.updatePsnl0132_REFE_FLSZ" parameterClass="psnl0132Vo">
		<![CDATA[
			UPDATE PSNL0132
			  SET  ISMT = #ismt#			
				, REVN_DT = TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')  			
				, REVN_ADDR	=  #revnAddr#	
				, REFE_FLSZ	= #refeFlsz# 
			WHERE DPOB_CD=#dpobCd#
				AND SYSTEMKEY=#systemkey#
				AND REFE_SEIL_NUM=#refeSeilNum#
				AND REPLACE(REFE_FL_SEIL_NUM, ' ', '') = #refeFlSeilNum#
		]]>			
	</update>

</sqlMap>
