<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Payr0307">
	
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="payr0307SrhVO" type="com.app.exterms.payroll.server.vo.Payr0307SrhVO"/>
	
	<resultMap id="payr0307" class="com.app.exterms.payroll.server.vo.Payr0307VO">
	    <result property="dpobCd" column="DPOB_CD" columnIndex="1"/>
		<result property="pymtYrMnth" column="PYMT_YR_MNTH" columnIndex="2"/>
		<result property="payCd" column="PAY_CD" columnIndex="3"/>
		<result property="payrSeilNum" column="PAYR_SEIL_NUM" columnIndex="4"/>
		<result property="systemkey" column="SYSTEMKEY" columnIndex="5"/>
		<result property="mnthPayAdmntSeilNum" column="MNTH_PAY_ADMNT_SEIL_NUM" columnIndex="6"/>
		<result property="payItemCd" column="PAY_ITEM_CD" columnIndex="7"/>
		<result property="pymtDducDivCd" column="PYMT_DDUC_DIV_CD" columnIndex="8"/>
		<result property="pymtDducSum" column="PYMT_DDUC_SUM" columnIndex="9"/>
		<result property="pymtDducFreeDtySum" column="PYMT_DDUC_FREE_DTY_SUM" columnIndex="10"/>
		<result property="mnthPayAdmntAssoBssCtnt" column="MNTH_PAY_ADMNT_ASSO_BSS_CTNT" columnIndex="11"/>
		<result property="mnthPayAdmntYn" column="MNTH_PAY_ADMNT_YN" columnIndex="12"/>
		<result property="kybdr" column="KYBDR" columnIndex="13"/>
		<result property="inptDt" column="INPT_DT" columnIndex="14"/>
		<result property="inptAddr" column="INPT_ADDR" columnIndex="15"/>
		<result property="ismt" column="ISMT" columnIndex="16"/>
		<result property="revnDt" column="REVN_DT" columnIndex="17"/>
		<result property="revnAddr" column="REVN_ADDR" columnIndex="18"/>
		<result property="pymtDducTxtnAmnt" column="PYMT_DDUC_TXTN_AMNT" columnIndex="19"/>  
	</resultMap>
	
	
	<!-- 엑셀 업로드 시 대상자 정보를 가져옴 -->
	<select id="payr0307DAO.selectPsnl0100Check" parameterClass="payr0307SrhVO" resultClass="egovMap">
	    SELECT AA.DPOB_CD
		       , AA.SYSTEMKEY
		       , AA.HAN_NM
		       , AA.RESN_REGN_NUM
		       , AA.BUSIN_CD
		       , ( '('|| ( SELECT BUSIN_APPTN_YR 
			       			FROM BASS0500
			       		   WHERE DPOB_CD = AA.DPOB_CD 
			       		   	AND  DEPT_CD = AA.CURR_AFFN_DEPT_CD 
			       		   	AND  BUSIN_CD = AA.BUSIN_CD 
			       		   	AND  BUSIN_APPTN_YR = SUBSTR(AA.EMYMT_BGNN_DT,1,4)
		       		   		)
		        	||')'
		        	|| fcBass0500CDNM(AA.DPOB_CD, SUBSTR(AA.EMYMT_BGNN_DT,1,4),AA.CURR_AFFN_DEPT_CD, AA.BUSIN_CD)
		        	) AS BUSIN_CD_NM  
		       , (AA.CURR_AFFN_DEPT_CD) AS DEPT_CD
		       , fcBass0400CDNM(AA.DPOB_CD, AA.CURR_AFFN_DEPT_CD,'2') AS DEPT_CD_NM
		       , AA.TYP_OCCU_CD
		       , AA.DTIL_OCCU_INTTN_CD
		       , FCBASSEX0350CDNM(AA.DPOB_CD, AA.TYP_OCCU_CD, AA.DTIL_OCCU_INTTN_CD,'1' ) AS DTIL_OCCU_INTTN_CD_NM
		  FROM PSNL0100 AA
		WHERE AA.RESN_REGN_NUM = REPLACE(#resnRegnNum#,'-','')
		   AND ROWNUM = 1
	</select>
	
	<insert id="payr0307DAO.insertPayr0307_S">
		<![CDATA[
				INSERT INTO PAYR0307 
				( DPOB_CD
				  , PYMT_YR_MNTH
				  , PAY_CD
				  , PAYR_SEIL_NUM
				  , SYSTEMKEY
				  , MNTH_PAY_ADMNT_SEIL_NUM
				  , PAY_ITEM_CD
				  , PYMT_DDUC_DIV_CD
				  , PYMT_DDUC_SUM
				  , PYMT_DDUC_FREE_DTY_SUM
				  , MNTH_PAY_ADMNT_ASSO_BSS_CTNT
				  , MNTH_PAY_ADMNT_YN
				  , KYBDR
				  , INPT_DT
				  , INPT_ADDR
				  , ISMT
				  , REVN_DT
				  , REVN_ADDR
				  , PYMT_DDUC_TXTN_AMNT )
			VALUES ( #dpobCd#
				  , #pymtYrMnth#
				  , #payCd#
				  , #payrSeilNum#
				  , #systemkey#
				  , (SELECT NVL(MAX(MNTH_PAY_ADMNT_SEIL_NUM),0)+1 
				       FROM PAYR0307 
				     	WHERE DPOB_CD=#dpobCd#
								AND PYMT_YR_MNTH=#pymtYrMnth#
								AND PAY_CD=#payCd#
								AND PAYR_SEIL_NUM=#payrSeilNum#
								AND SYSTEMKEY=#systemkey#) 
				  , #payItemCd#
				  , #pymtDducDivCd#
				  , #pymtDducSum#
				  , #pymtDducFreeDtySum#
				  , #mnthPayAdmntAssoBssCtnt#
				  , #mnthPayAdmntYn#
				  , #kybdr#
				  , TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')
				  , #inptAddr#
				  , #ismt#
				  , TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')
				  , #revnAddr#
				  , #pymtDducTxtnAmnt# )
				   
		]]>
	</insert>
	
	<update id="payr0307DAO.updatePayr0307_S">
		<![CDATA[
			UPDATE PAYR0307
			SET DPOB_CD=#dpobCd#
				, PYMT_YR_MNTH=#pymtYrMnth#
				, PAY_CD=#payCd#
				, PAYR_SEIL_NUM=#payrSeilNum#
				, SYSTEMKEY=#systemkey#
				, MNTH_PAY_ADMNT_SEIL_NUM=#mnthPayAdmntSeilNum#
				, PAY_ITEM_CD=#payItemCd#
				, PYMT_DDUC_DIV_CD=#pymtDducDivCd#
				, PYMT_DDUC_SUM=#pymtDducSum#
				, PYMT_DDUC_FREE_DTY_SUM=#pymtDducFreeDtySum#
				, MNTH_PAY_ADMNT_ASSO_BSS_CTNT=#mnthPayAdmntAssoBssCtnt#
				, MNTH_PAY_ADMNT_YN=#mnthPayAdmntYn# 
				, ISMT=#ismt#
				, REVN_DT=TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')
				, REVN_ADDR=#revnAddr#
				, PYMT_DDUC_TXTN_AMNT=#pymtDducTxtnAmnt#
						WHERE DPOB_CD=#dpobCd#
								AND PYMT_YR_MNTH=#pymtYrMnth#
								AND PAY_CD=#payCd#
								AND PAYR_SEIL_NUM=#payrSeilNum#
								AND SYSTEMKEY=#systemkey#
								AND MNTH_PAY_ADMNT_SEIL_NUM=#mnthPayAdmntSeilNum#
				]]>
	</update>
	
	<delete id="payr0307DAO.deletePayr0307_S">
		<![CDATA[
			DELETE FROM PAYR0307 
						WHERE DPOB_CD=#dpobCd#
								AND PYMT_YR_MNTH=#pymtYrMnth#
								AND PAY_CD=#payCd#
								AND PAYR_SEIL_NUM=#payrSeilNum#
								AND SYSTEMKEY=#systemkey#
									]]>
								<isNotEmpty prepend="AND" property="mnthPayAdmntSeilNum" >
					 	 MNTH_PAY_ADMNT_SEIL_NUM=#mnthPayAdmntSeilNum#
				           </isNotEmpty>  	 
				           	<isNotEmpty prepend="AND" property="payItemCd" >
					     	 PAY_ITEM_CD=#payItemCd#
				           </isNotEmpty>  	 
								 
	</delete>
	
		<delete id="payr0307DAO.deletePayCalculationPayr0307_S">
		<![CDATA[
		DELETE FROM PAYR0307 
						WHERE DPOB_CD=#dpobCd#
								AND PYMT_YR_MNTH=#pymtYrMnth#
								AND PAY_CD=#payCd#
								AND PAYR_SEIL_NUM=#payrSeilNum# 
								]]>						
						<isNotEmpty prepend="AND" property="systemkey" >
					 	  SYSTEMKEY=#systemkey#
				        </isNotEmpty>  	 
	</delete>
	
	
	
	<select id="payr0307DAO.selectPayr0307_S" resultMap="payr0307">
		<![CDATA[
			SELECT
				DPOB_CD
				, PYMT_YR_MNTH
				, PAY_CD
				, PAYR_SEIL_NUM
				, SYSTEMKEY
				, MNTH_PAY_ADMNT_SEIL_NUM
				, PAY_ITEM_CD
				, PYMT_DDUC_DIV_CD
				, PYMT_DDUC_SUM
				, PYMT_DDUC_FREE_DTY_SUM
				, MNTH_PAY_ADMNT_ASSO_BSS_CTNT
				, MNTH_PAY_ADMNT_YN
				, KYBDR
				, INPT_DT
				, INPT_ADDR
				, ISMT
				, REVN_DT
				, REVN_ADDR
				, PYMT_DDUC_TXTN_AMNT
			FROM PAYR0307
						WHERE DPOB_CD=#dpobCd#
								AND PYMT_YR_MNTH=#pymtYrMnth#
								AND PAY_CD=#payCd#
								AND PAYR_SEIL_NUM=#payrSeilNum#
								AND SYSTEMKEY=#systemkey#
								AND MNTH_PAY_ADMNT_SEIL_NUM=#mnthPayAdmntSeilNum#
				]]>
	</select>
	
	<select id="payr0307DAO.selectPayr0307Max_2S" resultMap="payr0307">
		<![CDATA[
			SELECT
				DPOB_CD
				, PYMT_YR_MNTH
				, PAY_CD
				, PAYR_SEIL_NUM
				, SYSTEMKEY
				, MNTH_PAY_ADMNT_SEIL_NUM
				, PAY_ITEM_CD
				, PYMT_DDUC_DIV_CD
				, PYMT_DDUC_SUM
				, PYMT_DDUC_FREE_DTY_SUM
				, MNTH_PAY_ADMNT_ASSO_BSS_CTNT
				, MNTH_PAY_ADMNT_YN
				, PYMT_DDUC_TXTN_AMNT
				, KYBDR
				, INPT_DT
				, INPT_ADDR
				, ISMT
				, REVN_DT
				, REVN_ADDR 
			FROM PAYR0307
						WHERE DPOB_CD=#dpobCd#
								AND PYMT_YR_MNTH=#pymtYrMnth#
								AND PYMT_DDUC_DIV_CD=#pymtDducDivCd#
								AND PAY_CD=#payCd#
								AND SYSTEMKEY=(SELECT SYSTEMKEY FROM PSNL0100 WHERE RESN_REGN_NUM = REPLACE(#resnRegnNum#,'-',''))
								AND MNTH_PAY_ADMNT_SEIL_NUM = ( SELECT MAX(MNTH_PAY_ADMNT_SEIL_NUM) 
																FROM PAYR0307
														       WHERE DPOB_CD=#dpobCd#
																	AND PYMT_YR_MNTH=#pymtYrMnth#
																	AND PAY_CD=#payCd#
																	AND PYMT_DDUC_DIV_CD=#pymtDducDivCd#
																	AND SYSTEMKEY=#systemkey#
															   ) 
				]]>
	</select> 
	
	<select id="payr0307DAO.selectPayr0307Max_S" resultMap="payr0307">
		<![CDATA[
			SELECT
				DPOB_CD
				, PYMT_YR_MNTH
				, PAY_CD
				, PAYR_SEIL_NUM
				, SYSTEMKEY
				, MNTH_PAY_ADMNT_SEIL_NUM
				, PAY_ITEM_CD
				, PYMT_DDUC_DIV_CD
				, PYMT_DDUC_SUM
				, PYMT_DDUC_FREE_DTY_SUM
				, MNTH_PAY_ADMNT_ASSO_BSS_CTNT
				, MNTH_PAY_ADMNT_YN
				, PYMT_DDUC_TXTN_AMNT
				, KYBDR
				, INPT_DT
				, INPT_ADDR
				, ISMT
				, REVN_DT
				, REVN_ADDR 
			FROM PAYR0307
						WHERE DPOB_CD=#dpobCd#
								AND PYMT_YR_MNTH=#pymtYrMnth#
								AND PAY_CD=#payCd#
								AND PAYR_SEIL_NUM=#payrSeilNum#
								AND SYSTEMKEY=#systemkey#
								AND MNTH_PAY_ADMNT_SEIL_NUM = (SELECT MAX(MNTH_PAY_ADMNT_SEIL_NUM) FROM PAYR0307
								       WHERE DPOB_CD=#dpobCd#
										AND PYMT_YR_MNTH=#pymtYrMnth#
										AND PAY_CD=#payCd#
										AND PAYR_SEIL_NUM=#payrSeilNum#
										AND SYSTEMKEY=#systemkey#) 
				]]>
	</select> 
	
	<select id="payr0307DAO.selectPayr0307All_S" resultMap="payr0307">
		<![CDATA[
			SELECT
				DPOB_CD
				, PYMT_YR_MNTH
				, PAY_CD
				, PAYR_SEIL_NUM
				, SYSTEMKEY
				, MNTH_PAY_ADMNT_SEIL_NUM
				, PAY_ITEM_CD
				, PYMT_DDUC_DIV_CD
				, PYMT_DDUC_SUM
				, PYMT_DDUC_FREE_DTY_SUM
				, MNTH_PAY_ADMNT_ASSO_BSS_CTNT
				, MNTH_PAY_ADMNT_YN
				, PYMT_DDUC_TXTN_AMNT
				, KYBDR
				, INPT_DT
				, INPT_ADDR
				, ISMT
				, REVN_DT
				, REVN_ADDR 
			FROM PAYR0307
						WHERE DPOB_CD=#dpobCd#
								AND PYMT_YR_MNTH=#pymtYrMnth#
								AND PAY_CD=#payCd#
								AND PAYR_SEIL_NUM=#payrSeilNum#
								AND SYSTEMKEY=#systemkey# 
				]]>
	</select>
	
	
	
	<select id="payr0307DAO.selectPayr0307List_D" parameterClass="payr0307SrhVO" resultClass="egovMap">
SELECT * FROM (
	SELECT A.*, ROWNUM RNUM FROM (
				SELECT
							DPOB_CD
								, PYMT_YR_MNTH
								, PAY_CD
								, PAYR_SEIL_NUM
								, SYSTEMKEY
								, MNTH_PAY_ADMNT_SEIL_NUM
								, PAY_ITEM_CD
								, PYMT_DDUC_DIV_CD
								, PYMT_DDUC_SUM
								, PYMT_DDUC_FREE_DTY_SUM
								, MNTH_PAY_ADMNT_ASSO_BSS_CTNT
								, MNTH_PAY_ADMNT_YN
								, KYBDR
								, INPT_DT
								, INPT_ADDR
								, ISMT
								, REVN_DT
								, REVN_ADDR
								, PYMT_DDUC_TXTN_AMNT
						FROM PAYR0307
				WHERE 1=1
				<isEqual prepend="AND" property="searchCondition" compareValue="0">
					PYMT_YR_MNTH = #searchKeyword#
				</isEqual>
				<isEqual prepend="AND" property="searchCondition" compareValue="1">
					PAY_CD LIKE '%' || #searchKeyword# || '%'
				</isEqual>
					ORDER BY 
						DPOB_CD DESC
							, PYMT_YR_MNTH DESC
							, PAY_CD DESC
							, PAYR_SEIL_NUM DESC
							, SYSTEMKEY DESC
							, MNTH_PAY_ADMNT_SEIL_NUM DESC
		
		<![CDATA[					
	) A WHERE ROWNUM <= #lastIndex#
)WHERE RNUM >= #firstIndex#
]]>
	</select>	
	<select id="payr0307DAO.selectPayr0307ListTotCnt_S" parameterClass="payr0307SrhVO" resultClass="int">
			SELECT COUNT(*) totcnt
			FROM PAYR0307
			WHERE 1=1
			<isEqual prepend="AND" property="searchCondition" compareValue="0">
				PYMT_YR_MNTH = #searchKeyword#
			</isEqual>
			<isEqual prepend="AND" property="searchCondition" compareValue="1">
				PAY_CD LIKE '%' || #searchKeyword# || '%'
			</isEqual>
	</select>
	
	
	<select id="payr0307DAO.selectPayr0307ToPayr4200List_D" parameterClass="payr0307SrhVO" resultClass="egovMap">
SELECT * FROM (
	SELECT A.*, ROWNUM RNUM FROM (
				SELECT         FF.DPOB_CD
								 , FF.PYMT_YR_MNTH
								, FF.PAY_CD
								, FF.PAY_CD AS payCdcommCd
								,fcBass0300CDNM(#dpobCd#,FF.PAY_CD) AS payCdcommCdNm
								, FF.SYSTEMKEY
								, FF.PAY_ITEM_CD
								,(
								SELECT
									PAY_DDUC_NM
									FROM
									(SELECT
										  DPOB_CD
										, PAY_DDUC_CD 
										, PAY_DDUC_NM 
									FROM PAYR0470
									UNION ALL
									 SELECT 
										DPOB_CD
										, PAY_EXTPY_CD 
										, PAY_EXTPY_NM 
									FROM PAYR0480) AA
								WHERE AA.DPOB_CD = #dpobCd#
								AND AA.PAY_DDUC_CD = FF.PAY_ITEM_CD
								) AS PAY_ITEM_NM
								, FF.PYMT_DDUC_DIV_CD
								, FF.PYMT_DDUC_DIV_CD AS pymtDducDivCdcommCd
								, fcBass0300CDNM(#dpobCd#,FF.PYMT_DDUC_DIV_CD) AS pymtDducDivCdcommCdNm
								, FF.PYMT_DDUC_FREE_DTY_SUM
								, FF.PYMT_DDUC_SUM
								, FF.MNTH_PAY_ADMNT_ASSO_BSS_CTNT
								, FF.MNTH_PAY_ADMNT_YN
								, FF.KYBDR
								, FF.INPT_DT
								, FF.INPT_ADDR
								, FF.ISMT
								, FF.REVN_DT
								, FF.REVN_ADDR
								, GG.PAYR_MANG_DEPT_CD
								, (SELECT PAY_MANGE_DEPT_NM FROM BASS0150 
								                           WHERE BASS0150.PAYR_MANG_DEPT_CD = GG.PAYR_MANG_DEPT_CD) AS PAY_MANGE_DEPT_NM
								, FF.PAYR_SEIL_NUM
								, FF.MNTH_PAY_ADMNT_SEIL_NUM 
									, FF.PYMT_DDUC_TXTN_AMNT
							    , GG.RESN_REGN_NUM
						FROM PAYR0307 FF, PAYR0304 GG
				WHERE  FF.DPOB_CD  = GG.DPOB_CD
					AND FF.PYMT_YR_MNTH  = GG.PYMT_YR_MNTH
					AND FF.SYSTEMKEY  = GG.SYSTEMKEY 
					AND FF.PAY_CD = GG.PAY_CD 
                    AND FF.PAYR_SEIL_NUM  = GG.PAYR_SEIL_NUM 
			   <isNotEmpty prepend="AND" property="dpobCd" >
			 	  FF.DPOB_CD=#dpobCd#
		       </isNotEmpty>
				     <isNotEmpty prepend="AND" property="systemkey" >
					 	FF.SYSTEMKEY=#systemkey#
				       </isNotEmpty> 
				       <isNotEmpty prepend="AND" property="payrMangDeptCd" >
					 	GG.PAYR_MANG_DEPT_CD=#payrMangDeptCd#
				       </isNotEmpty> 
				        <isNotEmpty prepend="AND" property="payCd" >
					 	FF.PAY_CD=#payCd#
				       </isNotEmpty> 
				           <isNotEmpty prepend="AND" property="pymtYrMnth" >
					 	FF.PYMT_YR_MNTH = #pymtYrMnth#
				       </isNotEmpty> 
				         <isNotEmpty prepend="AND" property="payrSeilNum" >
					 	FF.PAYR_SEIL_NUM=#payrSeilNum#
				       </isNotEmpty> 
					ORDER BY 
						    FF.DPOB_CD ASC
							, FF.PYMT_YR_MNTH ASC
							, FF.PAY_CD ASC
							, FF.PAYR_SEIL_NUM ASC
							, GG.RESN_REGN_NUM ASC
							, FF.SYSTEMKEY ASC
							, FF.MNTH_PAY_ADMNT_SEIL_NUM ASC
		
		<![CDATA[					
	) A WHERE ROWNUM <= #lastIndex#
)WHERE RNUM >= #firstIndex#
]]>
	</select>	
	<select id="payr0307DAO.selectPayr0307ToPayr4200ListTotCnt_S" parameterClass="payr0307SrhVO" resultClass="int">
			SELECT COUNT(*) totcnt
				FROM PAYR0307 FF, PAYR0304 GG
				WHERE  FF.DPOB_CD  = GG.DPOB_CD
					AND FF.PYMT_YR_MNTH  = GG.PYMT_YR_MNTH
					AND FF.SYSTEMKEY  = GG.SYSTEMKEY 
					AND FF.PAY_CD = GG.PAY_CD 
                    AND FF.PAYR_SEIL_NUM  = GG.PAYR_SEIL_NUM 
			   <isNotEmpty prepend="AND" property="dpobCd" >
			 	  FF.DPOB_CD=#dpobCd#
		       </isNotEmpty>
				     <isNotEmpty prepend="AND" property="systemkey" >
					 	FF.SYSTEMKEY=#systemkey#
				       </isNotEmpty> 
				       <isNotEmpty prepend="AND" property="payrMangDeptCd" >
					 	GG.PAYR_MANG_DEPT_CD=#payrMangDeptCd#
				       </isNotEmpty> 
				        <isNotEmpty prepend="AND" property="payCd" >
					 	FF.PAY_CD=#payCd#
				       </isNotEmpty> 
				           <isNotEmpty prepend="AND" property="pymtYrMnth" >
					 	FF.PYMT_YR_MNTH = #pymtYrMnth#
				       </isNotEmpty> 
				         <isNotEmpty prepend="AND" property="payrSeilNum" >
					 	FF.PAYR_SEIL_NUM=#payrSeilNum#
				       </isNotEmpty> 
	</select>
	

	<select id="payr0307DAO.selectPayr0307ToFreeCalcList_D" parameterClass="payr0307SrhVO" resultClass="egovMap"> 
		<![CDATA[	 
		SELECT 
			     AA.DPOB_CD, AA.PYMT_YR_MNTH, AA.PAY_CD, 
			     AA.PAYR_SEIL_NUM, AA.SYSTEMKEY,    
			     AA.TP_EXTPY_TOT_AMNT,
			     AA.TP_TXTN_TOT_AMNT,
			     AA.TP_FREE_DTY_TOT_AMNT,
			     DD.FREE_DTY_SUM
			 FROM
			(SELECT 
			    DPOB_CD, PYMT_YR_MNTH, PAY_CD, 
			    PAYR_SEIL_NUM, SYSTEMKEY,PAY_ITEM_CD,  
			    SUM(CASE WHEN PYMT_DDUC_DIV_CD IN ('B0080020') 
			        THEN PYMT_DDUC_SUM  
			        ELSE 0 END)  AS TP_EXTPY_TOT_AMNT,
			    SUM(CASE WHEN PYMT_DDUC_DIV_CD IN ('B0080010', 'B0080020' ) 
			        THEN PYMT_DDUC_TXTN_AMNT  
			        ELSE 0 END)  AS TP_TXTN_TOT_AMNT,
			     SUM(CASE WHEN PYMT_DDUC_DIV_CD IN ('B0080020' ) 
			        THEN  PYMT_DDUC_FREE_DTY_SUM 
				ELSE 0 END) AS TP_FREE_DTY_TOT_AMNT
			FROM PAYR0302
			WHERE DPOB_CD=#dpobCd#
				AND PYMT_YR_MNTH=#pymtYrMnth#
				AND PAY_CD=#payCd#
				AND PAYR_SEIL_NUM=#payrSeilNum#
				AND SYSTEMKEY=#systemkey#  
				AND PAY_ITEM_CD = 'C9080100'
			GROUP BY DPOB_CD, PYMT_YR_MNTH, PAY_CD, 
			   PAYR_SEIL_NUM, SYSTEMKEY,PAY_ITEM_CD) AA , PAYR0304 BB,  PAYR0400 CC, PAYR0410 DD
			WHERE AA.DPOB_CD = BB.DPOB_CD
			AND   AA.PYMT_YR_MNTH = BB.PYMT_YR_MNTH
			AND   AA.PAY_CD = BB.PAY_CD
			AND   AA.PAYR_SEIL_NUM = BB.PAYR_SEIL_NUM
			AND   AA.SYSTEMKEY = BB.SYSTEMKEY  
			AND   BB.DPOB_CD  = CC.DPOB_CD
			AND   BB.TYP_OCCU_CD = CC.TYP_OCCU_CD 
			AND   BB.DTIL_OCCU_INTTN_CD = CC.DTIL_OCCU_INTTN_CD
			AND   CC.DPOB_CD =DD.DPOB_CD
			AND   SUBSTR(AA.PYMT_YR_MNTH,1,4) = DD.PAY_YR 
			AND   CC.TYP_OCCU_GRDE_MPPG_SEIL_NUM = DD.TYP_OCCU_GRDE_MPPG_SEIL_NUM
			AND   AA.PAY_ITEM_CD = DD.PAYR_IMCD
        ]]>
	</select>
	
	
		<select id="payr0307DAO.selectPayr0307ToPayr420001List_D" parameterClass="payr0307SrhVO" resultClass="egovMap">
						SELECT    FF.DPOB_CD
										, FF.PYMT_YR_MNTH
										, FF.PAY_CD
										, FF.PAY_CD AS payCdcommCd
										,fcBass0300CDNM(#dpobCd#,FF.PAY_CD) AS payCdcommCdNm
										,fcBass0300CDNM(#dpobCd#,FF.PAY_CD) AS PAY_NM
										, FF.SYSTEMKEY
										, FF.PAY_ITEM_CD
										,(
										SELECT
											PAY_DDUC_NM
											FROM
											(SELECT
												  DPOB_CD
												, PAY_DDUC_CD 
												, PAY_DDUC_NM 
											FROM PAYR0470
											UNION ALL
											 SELECT 
												DPOB_CD
												, PAY_EXTPY_CD 
												, PAY_EXTPY_NM 
											FROM PAYR0480) AA
										WHERE AA.DPOB_CD = #dpobCd#
										AND AA.PAY_DDUC_CD = FF.PAY_ITEM_CD
										) AS PAY_ITEM_NM
										, FF.PYMT_DDUC_DIV_CD
										, FF.PYMT_DDUC_DIV_CD AS pymtDducDivCdcommCd
										, fcBass0300CDNM(#dpobCd#,FF.PYMT_DDUC_DIV_CD) AS pymtDducDivCdcommCdNm
										, fcBass0300CDNM(#dpobCd#,FF.PYMT_DDUC_DIV_CD) AS PYMT_DDUC_DIV_NM  
										, FF.PYMT_DDUC_FREE_DTY_SUM   
										, FF.PYMT_DDUC_SUM   
										, FF.MNTH_PAY_ADMNT_ASSO_BSS_CTNT  
										, FF.MNTH_PAY_ADMNT_YN
										, FF.KYBDR
										, FF.INPT_DT
										, FF.INPT_ADDR
										, FF.ISMT
										, FF.REVN_DT
										, FF.REVN_ADDR
										, GG.PAYR_MANG_DEPT_CD
										, (SELECT PAY_MANGE_DEPT_NM FROM BASS0150 
										                           WHERE BASS0150.PAYR_MANG_DEPT_CD = GG.PAYR_MANG_DEPT_CD) AS PAY_MANGE_DEPT_NM
										, FF.PAYR_SEIL_NUM
										, FF.MNTH_PAY_ADMNT_SEIL_NUM 
										, FF.PYMT_DDUC_TXTN_AMNT   
									    , GG.RESN_REGN_NUM
									    , GG.EMYMT_DIV_CD
		                                , fcBass0300CDNM(GG.DPOB_CD,GG.EMYMT_DIV_CD) AS EMYMT_DIV_NM
		                                , GG.HAN_NM 
		                                , GG.DEPT_CD
		                                , fcBass0400CDNM(GG.DPOB_CD,GG.DEPT_CD,'2') AS DEPT_NM
		                                , GG.BUSIN_CD
		                                , fcBass0500CDNM(GG.DPOB_CD,SUBSTR(GG.PYMT_YR_MNTH,1,4),GG.DEPT_CD,GG.BUSIN_CD) AS BUSIN_NM
		                                , GG.TYP_OCCU_CD
		                                ,  fcBass0320CDNM(GG.DPOB_CD,GG.TYP_OCCU_CD)   AS TYP_OCCU_NM
		                                , GG.DTIL_OCCU_CLS_DIV_CD
		                                , GG.DTIL_OCCU_INTTN_CD 
				          				, fcBassEx0350CDNM(GG.DPOB_CD,GG.TYP_OCCU_CD,GG.DTIL_OCCU_INTTN_CD,'1' ) AS DTIL_OCCU_CLS_DIV_NM 
		                                , NVL(GG.PYSP_GRDE_CD,'A0060000') AS PYSP_GRDE_CD
		                                , fcBass0300CDNM(GG.DPOB_CD,NVL(GG.PYSP_GRDE_CD,'A0060000')) AS PYSP_GRDE_NM
		                                , GG.LOG_SVC_YR_NUM_CD
		                                , fcBass0300CDNM(GG.DPOB_CD,GG.LOG_SVC_YR_NUM_CD) AS LOG_SVC_YR_NUM_NM
		                                , GG.LOG_SVC_MNTH_ICM_CD
		                                , fcBass0300CDNM(GG.DPOB_CD,GG.LOG_SVC_MNTH_ICM_CD) AS LOG_SVC_MNTH_ICM_NM
								FROM PAYR0307 FF, PAYR0304 GG
						WHERE  FF.DPOB_CD  = GG.DPOB_CD
							AND FF.PYMT_YR_MNTH  = GG.PYMT_YR_MNTH
							AND FF.SYSTEMKEY  = GG.SYSTEMKEY 
							AND FF.PAY_CD = GG.PAY_CD 
		                    AND FF.PAYR_SEIL_NUM  = GG.PAYR_SEIL_NUM 
							<isNotEmpty prepend="AND" property="dpobCd" >
								FF.DPOB_CD=#dpobCd#
							</isNotEmpty>
							<isNotEmpty prepend="AND" property="systemkey" >
								FF.SYSTEMKEY=#systemkey#
							</isNotEmpty> 
							<isNotEmpty prepend="AND" property="payrMangDeptCd" >
							 	GG.PAYR_MANG_DEPT_CD=#payrMangDeptCd#
							</isNotEmpty> 
							<isNotEmpty prepend="AND" property="payCd" >
								GG.PAY_CD=#payCd#
							</isNotEmpty> 
							<isNotEmpty prepend="AND" property="pymtYrMnth" >
							 	GG.PYMT_YR_MNTH = #pymtYrMnth#
							</isNotEmpty> 
					       	<isNotEmpty prepend="AND" property="emymtDivCd" >
							 	GG.EMYMT_DIV_CD=#emymtDivCd#
					       	</isNotEmpty> 
							<isNotEmpty prepend="AND" property="payrSeilNum" >
							 	GG.PAYR_SEIL_NUM=#payrSeilNum#
							</isNotEmpty> 
							<isNotEmpty prepend="AND" property="pymtDducDivCd" >
							 	 FF.PAY_ITEM_CD=#pymtDducDivCd#
							</isNotEmpty> 
							<isNotEmpty prepend="AND" property="payItemCd" >
							 	FF.PYMT_DDUC_DIV_CD=#payItemCd#
							</isNotEmpty> 
							
								AND EXISTS  ( SELECT C.DPOB_CD
				      									, C.DTIL_OCCU_INTTN_CD
				                                 		, C.TYP_OCCU_CD
				                                 		, C.DEPT_CD 
												FROM ( SELECT * 
                                                 FROM TABLE(PKG_DTIL_AUTH.FN_DTIL_AUTH_TB(#dpobCd#,#payrMangDeptYn#,#payrMangDeptCd#,#deptCd#,#usrId#,#deptCdAuth#,'' )) ) C
				                                            WHERE     C.DPOB_CD = GG.DPOB_CD
										                        AND C.DEPT_CD = GG.DEPT_CD
										                        AND NVL(C.TYP_OCCU_CD,'TT')  = NVL(GG.TYP_OCCU_CD,'TT') 
				                                                AND NVL(C.DTIL_OCCU_INTTN_CD,'TT')  = NVL(GG.DTIL_OCCU_INTTN_CD,'TT')
				                                               <isNotEmpty property="deptCd" prepend="AND">
																<![CDATA[
																 C.DEPT_CD
																]]>
																<iterate prepend="IN" property="deptCdArr" open="(" close=")" conjunction=",">
																 #deptCdArr[]#
																</iterate>
																</isNotEmpty>  
				                                          )  
								       
							<isNotEmpty property="typOccuCd" prepend="AND">
								<![CDATA[
									GG.TYP_OCCU_CD
								]]>
								<iterate prepend="IN" property="typOccuCdArr" open="(" close=")" conjunction=",">
									#typOccuCdArr[]#
								</iterate>
							</isNotEmpty>  
							<isNotEmpty property="dtilOccuInttnCd" prepend="AND">
								<![CDATA[
									GG.DTIL_OCCU_INTTN_CD
								]]>
								<iterate prepend="IN" property="dtilOccuInttnCdArr" open="(" close=")" conjunction=",">
									#dtilOccuInttnCdArr[]#
								</iterate>
							</isNotEmpty>  
							<isNotEmpty prepend="AND" property="hanNm" >
								GG.HAN_NM LIKE '%' || #hanNm# || '%'
							</isNotEmpty> 
							ORDER BY 
								    FF.DPOB_CD ASC
									, FF.PYMT_YR_MNTH ASC
									, FF.PAY_CD ASC
									, FF.PAYR_SEIL_NUM ASC
									, GG.RESN_REGN_NUM ASC
									, FF.SYSTEMKEY ASC
									, FF.MNTH_PAY_ADMNT_SEIL_NUM ASC
	</select>	
	<select id="payr0307DAO.selectPayr0307ToPayr420001ListTotCnt_S" parameterClass="payr0307SrhVO" resultClass="int">
		SELECT COUNT(*) totcnt
		  FROM PAYR0307 FF, PAYR0304 GG
		WHERE  FF.DPOB_CD  = GG.DPOB_CD
			AND FF.PYMT_YR_MNTH  = GG.PYMT_YR_MNTH
			AND FF.SYSTEMKEY  = GG.SYSTEMKEY 
			AND FF.PAY_CD = GG.PAY_CD 
			AND FF.PAYR_SEIL_NUM  = GG.PAYR_SEIL_NUM 
			<isNotEmpty prepend="AND" property="dpobCd" >
				FF.DPOB_CD=#dpobCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="systemkey" >
				FF.SYSTEMKEY=#systemkey#
			</isNotEmpty> 
			<isNotEmpty prepend="AND" property="payrMangDeptCd" >
			 	GG.PAYR_MANG_DEPT_CD=#payrMangDeptCd#
			</isNotEmpty> 
			<isNotEmpty prepend="AND" property="payCd" >
				GG.PAY_CD=#payCd#
			</isNotEmpty> 
			<isNotEmpty prepend="AND" property="pymtYrMnth" >
			 	GG.PYMT_YR_MNTH = #pymtYrMnth#
			</isNotEmpty> 
	       	<isNotEmpty prepend="AND" property="emymtDivCd" >
			 	GG.EMYMT_DIV_CD=#emymtDivCd#
	       	</isNotEmpty> 
			<isNotEmpty prepend="AND" property="payrSeilNum" >
			 	GG.PAYR_SEIL_NUM=#payrSeilNum#
			</isNotEmpty> 
			
				AND EXISTS  ( SELECT C.DPOB_CD
      									, C.DTIL_OCCU_INTTN_CD
                                 		, C.TYP_OCCU_CD
                                 		, C.DEPT_CD 
								FROM ( SELECT * 
                                                 FROM TABLE(PKG_DTIL_AUTH.FN_DTIL_AUTH_TB(#dpobCd#,#payrMangDeptYn#,#payrMangDeptCd#,#deptCd#,#usrId#,#deptCdAuth#,'' ))) C
                                            WHERE     C.DPOB_CD = GG.DPOB_CD
						                        AND C.DEPT_CD = GG.DEPT_CD
						                        AND NVL(C.TYP_OCCU_CD,'TT')  = NVL(GG.TYP_OCCU_CD,'TT') 
                                                AND NVL(C.DTIL_OCCU_INTTN_CD,'TT')  = NVL(GG.DTIL_OCCU_INTTN_CD,'TT')
                                               <isNotEmpty property="deptCd" prepend="AND">
												<![CDATA[
												 C.DEPT_CD
												]]>
												<iterate prepend="IN" property="deptCdArr" open="(" close=")" conjunction=",">
												 #deptCdArr[]#
												</iterate>
												</isNotEmpty>  
                                          )  
				       
			<isNotEmpty property="typOccuCd" prepend="AND">
				<![CDATA[
					GG.TYP_OCCU_CD
				]]>
				<iterate prepend="IN" property="typOccuCdArr" open="(" close=")" conjunction=",">
					#typOccuCdArr[]#
				</iterate>
			</isNotEmpty>  
			<isNotEmpty property="dtilOccuInttnCd" prepend="AND">
				<![CDATA[
					GG.DTIL_OCCU_INTTN_CD
				]]>
				<iterate prepend="IN" property="dtilOccuInttnCdArr" open="(" close=")" conjunction=",">
					#dtilOccuInttnCdArr[]#
				</iterate>
			</isNotEmpty>  
			<isNotEmpty prepend="AND" property="hanNm" >
				GG.HAN_NM LIKE '%' || #hanNm# || '%'
			</isNotEmpty> 
	</select>
	
	
	<!-- 급여조정내역 xls 입력  -->
	<insert id="payr0307DAO.insertXlsPayr0307_S">
		<![CDATA[
				INSERT INTO PAYR0307 
				( DPOB_CD
				  , PYMT_YR_MNTH
				  , PAY_CD
				  , PAYR_SEIL_NUM
				  , SYSTEMKEY
				  , MNTH_PAY_ADMNT_SEIL_NUM
				  , PAY_ITEM_CD
				  , PYMT_DDUC_DIV_CD
				  , PYMT_DDUC_SUM
				  , PYMT_DDUC_FREE_DTY_SUM
				  , MNTH_PAY_ADMNT_ASSO_BSS_CTNT
				  , MNTH_PAY_ADMNT_YN
				  , KYBDR
				  , INPT_DT
				  , INPT_ADDR
				  , ISMT
				  , REVN_DT
				  , REVN_ADDR
				  , PYMT_DDUC_TXTN_AMNT )
			VALUES ( #dpobCd#
				  , #pymtYrMnth#
				  , #payCd#
				  , (	SELECT DISTINCT NVL (MAX (B.PAYR_SEIL_NUM), 1) 
							FROM PAYR0307 A, PAYR0301 B 
					  	WHERE
					  		A.DPOB_CD = B.DPOB_CD
					  		AND A.PYMT_YR_MNTH = B.PYMT_YR_MNTH
					  		AND A.PAY_CD = B.PAY_CD
					  		AND A.SYSTEMKEY = B.SYSTEMKEY
							AND B.DPOB_CD=#dpobCd#
					  		AND B.PYMT_YR_MNTH=#pymtYrMnth#
					  		AND B.PAY_CD=#payCd#
					  		AND B.SYSTEMKEY=#systemkey#
					 )
				  , #systemkey#
				  , (SELECT NVL(MAX(A.MNTH_PAY_ADMNT_SEIL_NUM),0)+1 
				  		FROM PAYR0307 A, PAYR0301 B 
					  	WHERE
					  		A.DPOB_CD = B.DPOB_CD
					  		AND A.PYMT_YR_MNTH = B.PYMT_YR_MNTH
					  		AND A.PAY_CD = B.PAY_CD
					  		AND A.SYSTEMKEY = B.SYSTEMKEY
							AND B.DPOB_CD=#dpobCd#
					  		AND B.PYMT_YR_MNTH=#pymtYrMnth#
					  		AND B.PAY_CD=#payCd#
					  		AND B.SYSTEMKEY=#systemkey#
					 )
				  , #payItemCd#
				  , #pymtDducDivCd#
				  , #pymtDducSum#
				  , #pymtDducFreeDtySum#
				  , #mnthPayAdmntAssoBssCtnt#
				  , #mnthPayAdmntYn#
				  , #kybdr#
				  , TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')
				  , #inptAddr#
				  , #ismt#
				  , TO_CHAR(SYSDATE,'YYYYMMDDHHMISS')
				  , #revnAddr#
				  , #pymtDducTxtnAmnt# )
				   
		]]>
		
		<selectKey keyProperty="systemkey" resultClass="String">
			 SELECT SYSTEMKEY 
			   FROM PAYR0307
			 WHERE DPOB_CD=#dpobCd# 
			   AND PYMT_YR_MNTH =#pymtYrMnth# 
			   AND SYSTEMKEY =#systemkey#
			   AND PAY_CD=#payCd#
			   AND PAY_ITEM_CD =#payItemCd#
			   AND PAYR_SEIL_NUM = (	SELECT DISTINCT MAX(B.PAYR_SEIL_NUM) 
													FROM PAYR0307 A, PAYR0301 B 
											  	WHERE
											  		A.DPOB_CD = B.DPOB_CD
											  		AND A.PYMT_YR_MNTH = B.PYMT_YR_MNTH
											  		AND A.PAY_CD = B.PAY_CD
											  		AND A.SYSTEMKEY = B.SYSTEMKEY
													AND B.DPOB_CD=#dpobCd#
											  		AND B.PYMT_YR_MNTH=#pymtYrMnth#
											  		AND B.PAY_CD=#payCd#
											  		AND B.SYSTEMKEY=#systemkey#
											 )	
			   AND MNTH_PAY_ADMNT_SEIL_NUM = (	SELECT DISTINCT MAX(A.MNTH_PAY_ADMNT_SEIL_NUM) 
													FROM PAYR0307 A, PAYR0301 B 
											  	WHERE
											  		A.DPOB_CD = B.DPOB_CD
											  		AND A.PYMT_YR_MNTH = B.PYMT_YR_MNTH
											  		AND A.PAY_CD = B.PAY_CD
											  		AND A.SYSTEMKEY = B.SYSTEMKEY
													AND B.DPOB_CD=#dpobCd#
											  		AND B.PYMT_YR_MNTH=#pymtYrMnth#
											  		AND B.PAY_CD=#payCd#
											  		AND B.SYSTEMKEY=#systemkey#
											  		AND A.PAY_ITEM_CD=#payItemCd#
											 )											 							 
		</selectKey>
	</insert>	
	
	<!-- 급여조정내역 xls 삭제 -->
	<delete id="payr0307DAO.deleteXlsPayr0307_S">
		<![CDATA[
			DELETE FROM PAYR0307 
			WHERE DPOB_CD = #dpobCd#
				AND PYMT_YR_MNTH=#pymtYrMnth#
				AND PAYR_SEIL_NUM = (
									 SELECT DISTINCT B.PAYR_SEIL_NUM 
								  		FROM PAYR0307 A, PAYR0301 B 
								  	 WHERE A.DPOB_CD = B.DPOB_CD
								  		AND A.PYMT_YR_MNTH = B.PYMT_YR_MNTH
								  		AND A.PAY_CD = B.PAY_CD
								  		AND A.SYSTEMKEY = B.SYSTEMKEY
										AND B.DPOB_CD=#dpobCd#
								  		AND B.PYMT_YR_MNTH=#pymtYrMnth#
								  		AND B.PAY_CD=#payCd#
								  		AND B.SYSTEMKEY=#systemkey#
								     )
				AND PAY_CD=#payCd#
				AND PYMT_DDUC_DIV_CD = #pymtDducDivCd#
				AND PAY_ITEM_CD=#payItemCd#
				AND SYSTEMKEY=#systemkey#
		]]>
	</delete>
	
</sqlMap>
