<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="PkgInfcYe160403_2022">
	
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="infcPkgYe170403Srh_2022_Vo" type="com.app.smrmf.infc.yearendtax.server.vo.InfcPkgYe160403SrhVO"/>
	
	<resultMap id="infcPkgYe170403_2022" class="com.app.smrmf.infc.yearendtax.server.vo.InfcPkgYe160403VO">
		<result property="systemkey" column="SYSTEMKEY" columnIndex="1"/>
		<result property="elctYymm" column="ELCT_YYMM" columnIndex="2"/>
		<result property="dpobCd" column="DPOB_CD" columnIndex="3"/>
		<result property="yrtxBlggYr" column="YRTX_BLGG_YR" columnIndex="4"/>
		<result property="clutSeptCd" column="CLUT_SEPT_CD" columnIndex="5"/>
		<result property="taxmSa01Bi" column="TAXM_SA01_BI" columnIndex="6"/>
		<result property="taxmSb01Bi" column="TAXM_SB01_BI" columnIndex="7"/>
		<result property="taxmSc01Bi" column="TAXM_SC01_BI" columnIndex="8"/>
		<result property="taxmSd01Bi" column="TAXM_SD01_BI" columnIndex="9"/>
		<result property="taxmSe01Bi" column="TAXM_SE01_BI" columnIndex="10"/>
		<result property="taxmSe02Bi" column="TAXM_SE02_BI" columnIndex="11"/>
		<result property="taxmSe10Bi" column="TAXM_SE10_BI" columnIndex="12"/>
		<result property="taxmSf01Bi" column="TAXM_SF01_BI" columnIndex="13"/>
		<result property="taxmSg01Bi" column="TAXM_SG01_BI" columnIndex="14"/>
		<result property="taxmSh01Bi" column="TAXM_SH01_BI" columnIndex="15"/>
		<result property="taxmSh02Bi" column="TAXM_SH02_BI" columnIndex="16"/>
		<result property="taxmSh03Bi" column="TAXM_SH03_BI" columnIndex="17"/>
		<result property="taxmSh04Bi" column="TAXM_SH04_BI" columnIndex="18"/>
		<result property="taxmSh05Bi" column="TAXM_SH05_BI" columnIndex="19"/>
		<result property="taxmSh06Bi" column="TAXM_SH06_BI" columnIndex="20"/>
		<result property="taxmSh07Bi" column="TAXM_SH07_BI" columnIndex="21"/>
		<result property="taxmSh08Bi" column="TAXM_SH08_BI" columnIndex="22"/>
		<result property="taxmSh09Bi" column="TAXM_SH09_BI" columnIndex="23"/>
		<result property="taxmSh10Bi" column="TAXM_SH10_BI" columnIndex="24"/>
		<result property="taxmSh14Bi" column="TAXM_SH14_BI" columnIndex="25"/>
		<result property="taxmSh15Bi" column="TAXM_SH15_BI" columnIndex="26"/>
		<result property="taxmSh11Bi" column="TAXM_SH11_BI" columnIndex="27"/>
		<result property="taxmSh12Bi" column="TAXM_SH12_BI" columnIndex="28"/>
		<result property="taxmSh13Bi" column="TAXM_SH13_BI" columnIndex="29"/>
		<result property="taxmSh16Bi" column="TAXM_SH16_BI" columnIndex="30"/>
		<result property="taxmSi01Bi" column="TAXM_SI01_BI" columnIndex="31"/>
		<result property="taxmSj01Bi" column="TAXM_SJ01_BI" columnIndex="32"/>
		<result property="taxmSj10Bi" column="TAXM_SJ10_BI" columnIndex="33"/>
		<result property="taxmSk01Bi" column="TAXM_SK01_BI" columnIndex="34"/>
		<result property="taxmSl01Bi" column="TAXM_SL01_BI" columnIndex="35"/>
		<result property="taxmSm01Bi" column="TAXM_SM01_BI" columnIndex="36"/>
		<result property="taxmSm02Bi" column="TAXM_SM02_BI" columnIndex="37"/>
		<result property="taxmSm03Bi" column="TAXM_SM03_BI" columnIndex="38"/>
		<result property="taxmSn01Bi" column="TAXM_SN01_BI" columnIndex="39"/>
		<result property="taxmSo01Bi" column="TAXM_SO01_BI" columnIndex="40"/>
		<result property="taxmSp01Bi" column="TAXM_SP01_BI" columnIndex="41"/>
		<result property="taxmSp02Bi" column="TAXM_SP02_BI" columnIndex="42"/>
		<result property="taxmSq01Bi" column="TAXM_SQ01_BI" columnIndex="43"/>
		<result property="taxmSr01Bi" column="TAXM_SR01_BI" columnIndex="44"/>
		<result property="taxmSr10Bi" column="TAXM_SR10_BI" columnIndex="45"/>
		<result property="taxmSs01Bi" column="TAXM_SS01_BI" columnIndex="46"/>
		<result property="taxmSy02Bi" column="TAXM_SY02_BI" columnIndex="47"/>
		<result property="taxmSy03Bi" column="TAXM_SY03_BI" columnIndex="48"/>
		<result property="taxmSy04Bi" column="TAXM_SY04_BI" columnIndex="49"/>
		<result property="taxmSy21Bi" column="TAXM_SY21_BI" columnIndex="50"/>
		<result property="taxmSy22Bi" column="TAXM_SY22_BI" columnIndex="51"/>
		<result property="taxmSt01Bi" column="TAXM_ST01_BI" columnIndex="52"/>
		<result property="taxmSt10Bi" column="TAXM_ST10_BI" columnIndex="53"/>
		<result property="taxmSt11Bi" column="TAXM_ST11_BI" columnIndex="54"/>
		<result property="taxmSt12Bi" column="TAXM_ST12_BI" columnIndex="55"/>
		<result property="taxmSt20Bi" column="TAXM_ST20_BI" columnIndex="56"/>
		<result property="kybdr" column="KYBDR" columnIndex="57"/>
		<result property="inptDt" column="INPT_DT" columnIndex="58"/>
		<result property="inptAddr" column="INPT_ADDR" columnIndex="59"/>
		<result property="ismt" column="ISMT" columnIndex="60"/>
		<result property="revnDt" column="REVN_DT" columnIndex="61"/>
		<result property="revnAddr" column="REVN_ADDR" columnIndex="62"/>
		<result property="taxmSr11Bi" column="TAXM_SR11_BI" columnIndex="63"/>
	</resultMap>
	 
	
	<!-- 연말정산 급여이관 -->
	<insert id="infcPkgYe170403_2022_DAO.fnYeta7100_YE160403_PAYR_2022_CREATE_Insert_S">
		<![CDATA[
			INSERT INTO YE160403 
				( DPOB_CD
					  , ELCT_YYMM
					  , SYSTEMKEY
					  , YRTX_BLGG_YR
					  , CLUT_SEPT_CD
					  , TAXM_SA01_BI
					  , TAXM_SB01_BI
					  , TAXM_SC01_BI
					  , TAXM_SD01_BI
					  , TAXM_SE01_BI
					  , TAXM_SE02_BI
					  , TAXM_SE10_BI
					  , TAXM_SF01_BI
					  , TAXM_SG01_BI
					  , TAXM_SH01_BI
					  , TAXM_SH02_BI
					  , TAXM_SH03_BI
					  , TAXM_SH04_BI
					  , TAXM_SH05_BI
					  , TAXM_SH06_BI
					  , TAXM_SH07_BI
					  , TAXM_SH08_BI
					  , TAXM_SH09_BI
					  , TAXM_SH10_BI
					  , TAXM_SH14_BI
					  , TAXM_SH15_BI
					  , TAXM_SH11_BI
					  , TAXM_SH12_BI
					  , TAXM_SH13_BI
					  , TAXM_SH16_BI
					  , TAXM_SI01_BI
					  , TAXM_SJ01_BI
					  , TAXM_SJ10_BI
					  , TAXM_SK01_BI
					  , TAXM_SL01_BI
					  , TAXM_SM01_BI
					  , TAXM_SM02_BI
					  , TAXM_SM03_BI
					  , TAXM_SN01_BI
					  , TAXM_SO01_BI
					  , TAXM_SP01_BI
					  , TAXM_SP02_BI
					  , TAXM_SQ01_BI
					  , TAXM_SR01_BI
					  , TAXM_SR10_BI
					  , TAXM_SS01_BI
					  , TAXM_SY02_BI
					  , TAXM_SY03_BI
					  , TAXM_SY04_BI
					  , TAXM_SY21_BI
					  , TAXM_SY22_BI
					  , TAXM_ST01_BI
					  , TAXM_ST10_BI
					  , TAXM_ST11_BI
					  , TAXM_ST12_BI
					  , TAXM_ST20_BI
					  , KYBDR
					  , INPT_DT
					  , INPT_ADDR
					  , ISMT
					  , REVN_DT
					  , REVN_ADDR )
				  ( SELECT  DPOB_CD 
      ,  PYMT_YR_MNTH 
      ,  SYSTEMKEY  
                          , #yrtxBlggYr# 
                          , #clutSeptCd#
                          , (0) AS TAXM_SA01_BI
                          , (0) AS TAXM_SB01_BI
                          , (0) AS TAXM_SC01_BI
                          , (0) AS TAXM_SD01_BI
                          , (0) AS TAXM_SE01_BI
                          , (0) AS TAXM_SE02_BI
                          , (0) AS TAXM_SE10_BI
                          , (0) AS TAXM_SF01_BI
                          , (0) AS TAXM_SG01_BI
                          , (0) AS TAXM_SH01_BI
                          , (0) AS TAXM_SH02_BI 
                           ,   SUM(TAXM_SH03_BI) AS TAXM_SH03_BI /*  자가운전보조금    */
                          , (0) AS TAXM_SH04_BI
                          , (0) AS TAXM_SH05_BI
                          , (0) AS TAXM_SH06_BI
                          , (0) AS TAXM_SH07_BI
                          , (0) AS TAXM_SH08_BI
                          , (0) AS TAXM_SH09_BI
                          , (0) AS TAXM_SH10_BI
                          , (0) AS TAXM_SH14_BI
                          , (0) AS TAXM_SH15_BI
                          , (0) AS TAXM_SH11_BI
                          , (0) AS TAXM_SH12_BI
                          , (0) AS TAXM_SH13_BI
                          , (0) AS TAXM_SH16_BI
                          , (0) AS TAXM_SI01_BI
                          , (0) AS TAXM_SJ01_BI
                          , (0) AS TAXM_SJ10_BI
                          , (0) AS TAXM_SK01_BI
                          , (0) AS TAXM_SL01_BI
                          , (0) AS TAXM_SM01_BI
                          , (0) AS TAXM_SM02_BI
                          , (0) AS TAXM_SM03_BI
                          , (0) AS TAXM_SN01_BI
                          , (0) AS TAXM_SO01_BI
                         ,  SUM( TAXM_SP01_BI) AS TAXM_SP01_BI
                          , (0) AS TAXM_SP02_BI
                          , SUM( TAXM_SQ01_BI) AS TAXM_SQ01_BI 
                          , (0) AS TAXM_SR01_BI
                          , (0) AS TAXM_SR10_BI
                          , (0) AS TAXM_SS01_BI
                          , (0) AS TAXM_SY02_BI
                          , (0) AS TAXM_SY03_BI
                          , (0) AS TAXM_SY04_BI
                          , (0) AS TAXM_SY21_BI
                          , (0) AS TAXM_SY22_BI
                          , (0) AS TAXM_ST01_BI
                          , (0) AS TAXM_ST10_BI
                          , (0) AS TAXM_ST11_BI
                          , (0) AS TAXM_ST12_BI
                          , (0) AS TAXM_ST20_BI
                          , #kybdr#
                          , TO_CHAR(SYSDATE, 'YYYYMMDD')
                          , #inptAddr#
                          , #ismt#
                          , TO_CHAR(SYSDATE, 'YYYYMMDD')
                          , #revnAddr#  
FROM
(
SELECT   BB.DPOB_CD 
      ,  BB.PYMT_YR_MNTH 
      ,  BB.SYSTEMKEY 
    ,  NVL( ( 
                                     SELECT SUM(PYMT_DDUC_FREE_DTY_SUM)
                                     FROM 
                                     (SELECT DPOB_CD
                                            ,PYMT_YR_MNTH
                                            , SYSTEMKEY
                                            , PAY_ITEM_CD
                                            , PYMT_DDUC_FREE_DTY_SUM  
                                          FROM  PAYR0302
                                         WHERE PAY_ITEM_CD  = 'C9100200'
                                             AND NOT EXISTS
                                              (SELECT *
                                                 FROM (SELECT KW01.DPOB_CD,
                                                              KW01.PYYT_YR_MNTH, 
                                                              KW01.SYSTEMKEY,
                                                                KW01.PAY_CD
                                                         FROM PYYT0304 KW01) KW02
                                                WHERE     KW02.DPOB_CD = PAYR0302.DPOB_CD
                                                      AND KW02.PYYT_YR_MNTH = PAYR0302.PYMT_YR_MNTH
                                                      AND KW02.SYSTEMKEY = PAYR0302.SYSTEMKEY
                                                      AND   KW02.PAY_CD =   PAYR0302.PAY_CD) 
                                     UNION ALL
                                     SELECT  DPOB_CD
                                            ,PYYT_YR_MNTH
                                            ,SYSTEMKEY
                                            ,PYYT_ITEM_CD
                                            ,PYYT_PYDD_FREE_DTY_SUM  
                                          FROM  PYYT0302
                                         WHERE PYYT_ITEM_CD   = 'C9100200' ) A03   
                                         WHERE  A03.DPOB_CD = BB.DPOB_CD
                                           AND  A03.PYMT_YR_MNTH = BB.PYMT_YR_MNTH 
                                           AND  A03.SYSTEMKEY = BB.SYSTEMKEY
                                           AND  A03.PAY_ITEM_CD  = 'C9100200' 
                                         )
                                      , 0)   AS TAXM_SH03_BI /*  자가운전보조금    */
                          
                         , NVL( ( 
                                     SELECT SUM(PYMT_DDUC_FREE_DTY_SUM)
                                     FROM 
                                     (SELECT DPOB_CD
                                            ,PYMT_YR_MNTH
                                            , SYSTEMKEY
                                            , PAY_ITEM_CD
                                            , PYMT_DDUC_FREE_DTY_SUM  
                                          FROM  PAYR0302
                                         WHERE PAY_ITEM_CD  = 'C9080100'
                                           AND NOT EXISTS
                                              (SELECT *
                                                 FROM (SELECT KW01.DPOB_CD,
                                                              KW01.PYYT_YR_MNTH, 
                                                              KW01.SYSTEMKEY,
                                                                KW01.PAY_CD
                                                         FROM PYYT0304 KW01) KW02
                                                WHERE     KW02.DPOB_CD = PAYR0302.DPOB_CD
                                                      AND KW02.PYYT_YR_MNTH = PAYR0302.PYMT_YR_MNTH
                                                      AND KW02.SYSTEMKEY = PAYR0302.SYSTEMKEY
                                                      AND KW02.PAY_CD = PAYR0302.PAY_CD) 
                                     UNION ALL
                                     SELECT DPOB_CD
                                            ,PYYT_YR_MNTH
                                            ,SYSTEMKEY
                                            ,PYYT_ITEM_CD
                                            ,PYYT_PYDD_FREE_DTY_SUM  
                                          FROM  PYYT0302
                                         WHERE PYYT_ITEM_CD   = 'C9080100' ) A03   
                                         WHERE  A03.DPOB_CD = BB.DPOB_CD
                                           AND  A03.PYMT_YR_MNTH = BB.PYMT_YR_MNTH 
                                           AND  A03.SYSTEMKEY = BB.SYSTEMKEY
                                           AND  A03.PAY_ITEM_CD  = 'C9080100' 
                                         )
                                      , 0)   AS TAXM_SP01_BI
                         
                          , NVL( ( 
                                     SELECT SUM(PYMT_DDUC_FREE_DTY_SUM)
                                     FROM 
                                     (SELECT DPOB_CD
                                            ,PYMT_YR_MNTH
                                            , SYSTEMKEY
                                            , PAY_ITEM_CD
                                            , PYMT_DDUC_FREE_DTY_SUM  
                                          FROM  PAYR0302
                                         WHERE PAY_ITEM_CD  = 'C9050100'
                                           AND NOT EXISTS
                                              (SELECT *
                                                 FROM (SELECT KW01.DPOB_CD,
                                                              KW01.PYYT_YR_MNTH, 
                                                              KW01.SYSTEMKEY,
                                                                KW01.PAY_CD
                                                         FROM PYYT0304 KW01) KW02
                                                WHERE     KW02.DPOB_CD = PAYR0302.DPOB_CD
                                                      AND KW02.PYYT_YR_MNTH = PAYR0302.PYMT_YR_MNTH
                                                      AND KW02.SYSTEMKEY = PAYR0302.SYSTEMKEY
                                                      AND   KW02.PAY_CD = PAYR0302.PAY_CD) 
                                     UNION ALL
                                     SELECT  DPOB_CD
                                            ,PYYT_YR_MNTH
                                            ,SYSTEMKEY
                                            ,PYYT_ITEM_CD
                                            ,PYYT_PYDD_FREE_DTY_SUM  
                                          FROM  PYYT0302
                                         WHERE PYYT_ITEM_CD   = 'C9050100' ) A03   
                                         WHERE  A03.DPOB_CD = BB.DPOB_CD
                                           AND  A03.PYMT_YR_MNTH = BB.PYMT_YR_MNTH 
                                           AND  A03.SYSTEMKEY = BB.SYSTEMKEY
                                           AND  A03.PAY_ITEM_CD  = 'C9050100' 
                                         )
                                      , 0)  AS TAXM_SQ01_BI  
  FROM   ( SELECT  DISTINCT   AD02.DPOB_CD
                                              ,AD02.SYSTEMKEY
                                              ,AD02.PYMT_YR_MNTH
                                              ,AD02.PAYR_MANG_DEPT_CD
                                              ,AD02.EMYMT_DIV_CD
                                              ,AD02.HAN_NM
                                              ,AD02.RESN_REGN_NUM
                                              ,DECODE (AD02.EMYMT_DIV_CD, 'A0020020', AD02.DEPT_CD,DECODE(AD01.EMYMT_DIV_CD,'A0020020',AD02.DEPT_CD,AD01.CURR_AFFN_DEPT_CD)) AS DEPT_CD 
                                              ,DECODE (AD02.EMYMT_DIV_CD, 'A0020020', AD02.BUSIN_CD, DECODE(AD01.EMYMT_DIV_CD,'A0020020',AD02.BUSIN_CD,AD01.BUSIN_CD) ) AS BUSIN_CD 
                                              ,DECODE (AD02.EMYMT_DIV_CD, 'A0020020', AD02.TYP_OCCU_CD, DECODE(AD01.EMYMT_DIV_CD,'A0020020',AD02.TYP_OCCU_CD,AD01.TYP_OCCU_CD) ) AS TYP_OCCU_CD 
                                              ,DECODE (AD02.EMYMT_DIV_CD, 'A0020020', AD02.DTIL_OCCU_INTTN_CD, DECODE(AD01.EMYMT_DIV_CD,'A0020020',AD02.DTIL_OCCU_INTTN_CD,AD01.DTIL_OCCU_INTTN_CD) ) AS DTIL_OCCU_INTTN_CD 
                                             , DECODE (AD02.ODTY_CD,AD01.ODTY_CD, AD01.ODTY_CD,AD01.ODTY_CD) AS ODTY_CD 
                                            , DECODE (AD02.PYSP_CD, AD01.PYSP_CD, AD01.PYSP_CD, AD01.PYSP_CD) AS PYSP_CD  
                                            , DECODE (AD02.LOG_SVC_YR_NUM_CD, AD01.LOG_SVC_YR_NUM_CD, AD01.LOG_SVC_YR_NUM_CD, AD01.LOG_SVC_YR_NUM_CD) AS LOG_SVC_YR_NUM_CD 
                                            , DECODE (AD02.LOG_SVC_MNTH_ICM_CD, AD01.LOG_SVC_MNTH_ICM_CD, AD01.LOG_SVC_MNTH_ICM_CD, AD01.LOG_SVC_MNTH_ICM_CD) AS LOG_SVC_MNTH_ICM_CD 
                                            , DECODE (AD02.FRST_EMYMT_DT, AD01.FRST_EMYMT_DT, AD01.FRST_EMYMT_DT, AD01.FRST_EMYMT_DT) AS FRST_EMYMT_DT 
                                            , DECODE (AD02.EMYMT_BGNN_DT, AD01.EMYMT_BGNN_DT, AD01.EMYMT_BGNN_DT, AD01.EMYMT_BGNN_DT) AS EMYMT_BGNN_DT 
                                            , DECODE (AD02.EMYMT_END_DT, AD01.EMYMT_END_DT, AD01.EMYMT_END_DT, AD01.EMYMT_END_DT) AS EMYMT_END_DT 
                                              ,AD01.NATN_CD
                                              ,AD01.HDOFC_CODTN_CD
                                              ,AD01.RETRY_DT   
                                                FROM PSNL0100 AD01, ( SELECT 
                                               DPOB_CD, PYMT_YR_MNTH, SYSTEMKEY,  PAYR_SEIL_NUM,
                                               PAY_CD,  PAYR_MANG_DEPT_CD, 
                                               EMYMT_DIV_CD, HAN_NM, RESN_REGN_NUM, 
                                               DEPT_CD, BUSIN_CD, TYP_OCCU_CD,   DTIL_OCCU_INTTN_CD,
                                                 ODTY_CD, PYSP_CD, 
                                                 LOG_SVC_YR_NUM_CD, LOG_SVC_MNTH_ICM_CD, 
                                               FRST_EMYMT_DT, EMYMT_BGNN_DT, EMYMT_END_DT, 
                                               HDOFC_DIV_CD, RETRY_DT 
                                            FROM  PAYR0304 
                                            ) AD02,
                                                (SELECT NN.DPOB_CD,
                                                                       NN.PYMT_YR_MNTH,
                                                                       NN.PAY_CD,
                                                                       NN.SYSTEMKEY,
                                                                       NN.PAYR_SEIL_NUM
                                                             FROM    
                                                             (SELECT           DPOB_CD,
                                                                               PYMT_YR_MNTH,
                                                                               PAY_CD,
                                                                               SYSTEMKEY,
                                                                               MAX(PAYR_SEIL_NUM) AS PAYR_SEIL_NUM  
                                                                          FROM (SELECT 
                                                                               DPOB_CD, PYMT_YR_MNTH, SYSTEMKEY,  PAYR_SEIL_NUM,
                                                                               PAY_CD,  PAYR_MANG_DEPT_CD, 
                                                                               EMYMT_DIV_CD, HAN_NM, RESN_REGN_NUM, 
                                                                               DEPT_CD, BUSIN_CD, TYP_OCCU_CD,   DTIL_OCCU_INTTN_CD,
                                                                                 ODTY_CD, PYSP_CD, 
                                                                                 LOG_SVC_YR_NUM_CD, LOG_SVC_MNTH_ICM_CD, 
                                                                               FRST_EMYMT_DT, EMYMT_BGNN_DT, EMYMT_END_DT, 
                                                                               HDOFC_DIV_CD, RETRY_DT 
                                                                            FROM  PAYR0304 
                                                                         ) PAYR0304
                                                                         WHERE     PYMT_YR_MNTH LIKE #yrtxBlggYr# ||'%'  
                                                                             GROUP BY  DPOB_CD,  PYMT_YR_MNTH,
                                                                           PAY_CD, SYSTEMKEY  
                                                                         ) NN,
                                                                          (  
                                                                           SELECT        MM.DPOB_CD,
                                                                                         MM.PYMT_YR_MNTH ,
                                                                                         MM.PAY_CD , 
                                                                                         MM.SYSTEMKEY ,
                                                                                         MM.PAYR_SEIL_NUM ,    MM.SEL_NUM
                                                                             FROM    
                                                                             (  
                                                                            SELECT       SEL_NUM,
                                                                                         DPOB_CD,
                                                                                         PYMT_YR_MNTH ,
                                                                                         PAY_CD , 
                                                                                         SYSTEMKEY ,
                                                                                         PAYR_SEIL_NUM
                                                                             FROM 
                                                                              (SELECT  ROW_NUMBER ()
                                                                                         OVER (ORDER BY
                                                                                                  DPOB_CD,
                                                                                                  SYSTEMKEY,
                                                                                                  PYMT_YR_MNTH ASC,
                                                                                                  PAY_CD ASC,
                                                                                                  PAYR_SEIL_NUM DESC) AS SEL_NUM,
                                                                                         DPOB_CD,
                                                                                         PYMT_YR_MNTH ,
                                                                                         PAY_CD , 
                                                                                         SYSTEMKEY ,
                                                                                         PAYR_SEIL_NUM
                                                                                    FROM PAYR0304   
                                                                                      WHERE   PYMT_YR_MNTH  LIKE #yrtxBlggYr# ||'%'  
                                                                                       AND (SYSTEMKEY,PYMT_YR_MNTH) IN (
                                                                                          SELECT SYSTEMKEY, MAX(PYMT_YR_MNTH)
                                                                                        FROM PAYR0304 NNAA 
                                                                                        WHERE  NNAA.DPOB_CD = PAYR0304.DPOB_CD 
                                                                                          AND NNAA.PYMT_YR_MNTH = PAYR0304.PYMT_YR_MNTH
                                                                                          AND NNAA.SYSTEMKEY = PAYR0304.SYSTEMKEY
                                                                                          AND NNAA.PYMT_YR_MNTH  LIKE #yrtxBlggYr# ||'%'  
                                                                                          GROUP BY SYSTEMKEY
                                                                                                       )
                                                                                    )
                                                                                      ORDER BY  SEL_NUM DESC 
                                                                                    ) MM  
                                                                                     WHERE ROWNUM = 1  
                                                                                     AND SYSTEMKEY=#systemkey# 
                                                                                     ) GG
                                                                    WHERE NN.DPOB_CD = GG.DPOB_CD
                                                                      AND NN.SYSTEMKEY = GG.SYSTEMKEY   
                                                                      AND NN.PYMT_YR_MNTH = GG.PYMT_YR_MNTH 
                                                                  /*    AND NN.PAY_CD = GG.PAY_CD 
                                                                      AND NN.PAYR_SEIL_NUM = GG.PAYR_SEIL_NUM  */
                                                                              ) AD03
                                                             WHERE     AD02.DPOB_CD = AD01.DPOB_CD
                                                                   AND AD02.SYSTEMKEY = AD01.SYSTEMKEY
                                                                   AND AD02.DPOB_CD = AD03.DPOB_CD
                                                                   AND AD02.PYMT_YR_MNTH = AD03.PYMT_YR_MNTH
                                                                   AND AD02.SYSTEMKEY = AD03.SYSTEMKEY
                                                                   AND AD02.PAY_CD = AD03.PAY_CD
                                                                   AND AD02.PAYR_SEIL_NUM = AD03.PAYR_SEIL_NUM  
                                                  AND AD02.PYMT_YR_MNTH LIKE #yrtxBlggYr# ||'%'  ) AA ,  (
                     SELECT    AC01.DPOB_CD,AC01.PAY_CD,
                                    AC01.PYMT_YR_MNTH, 
                                    AC01.SYSTEMKEY,
                                    AC01.PAYR_MANG_DEPT_CD,
                                    AC01.EMYMT_DIV_CD,
                                    AC01.HAN_NM,
                                       AC02.PAY_PYMT_DT
                      FROM PAYR0304 AC01,
                           (  SELECT A03.DPOB_CD,
                                     A03.PYMT_YR_MNTH, 
                                     A03.SYSTEMKEY,
                                     MAX (A02.PAY_PYMT_DT) PAY_PYMT_DT
                                FROM PAYR0300 A02, PAYR0304 A03
                               WHERE     A02.DPOB_CD = A03.DPOB_CD
                                     AND A02.PYMT_YR_MNTH = A03.PYMT_YR_MNTH
                                     AND A02.PAY_CD = A03.PAY_CD
                                     AND A02.PAYR_SEIL_NUM = A03.PAYR_SEIL_NUM
                            GROUP BY A03.DPOB_CD,
                                     A03.PYMT_YR_MNTH, 
                                     A03.SYSTEMKEY) AC02
                     WHERE     AC01.DPOB_CD = AC02.DPOB_CD
                           AND AC01.PYMT_YR_MNTH = AC02.PYMT_YR_MNTH 
                           AND AC01.SYSTEMKEY = AC02.SYSTEMKEY
                           AND AC01.SYSTEMKEY=#systemkey# 
                            GROUP BY AC01.DPOB_CD,
                                    AC01.PYMT_YR_MNTH, 
                                    AC01.PAY_CD,
                                    AC01.SYSTEMKEY,
                                    AC01.PAYR_MANG_DEPT_CD,
                                    AC01.EMYMT_DIV_CD,
                                    AC01.HAN_NM  ,
                                    AC02.PAY_PYMT_DT
      ) BB   
 WHERE   BB.DPOB_CD=#dpobCd#  
      AND BB.SYSTEMKEY=#systemkey# 
      AND  BB.PYMT_YR_MNTH LIKE #yrtxBlggYr# ||'%'  
      AND  BB.DPOB_CD = AA.DPOB_CD
      AND  BB.SYSTEMKEY = AA.SYSTEMKEY
         ]]> 
                   <isEqual prepend="AND" property="addCheck" compareValue="ADD">
                      NOT  EXISTS (SELECT *
                                     FROM (SELECT  KF01.DPOB_CD 
                                                 , KF01.YRTX_BLGG_YR
                                                 , KF01.CLUT_SEPT_CD 
                                                 , KF01.SYSTEMKEY 
                                             FROM YE160401 KF01 ) KK01
                                    WHERE     KK01.DPOB_CD = AA.DPOB_CD
                                          AND KK01.YRTX_BLGG_YR = #yrtxBlggYr#
                                          AND KK01.CLUT_SEPT_CD = #clutSeptCd# 
                                          AND KK01.SYSTEMKEY = AA.SYSTEMKEY)  
                  </isEqual>  
           <![CDATA[          
                   AND NOT EXISTS
                              (SELECT *
                                 FROM (SELECT KW01.DPOB_CD,
                                              KW01.PYYT_YR_MNTH, 
                                              KW01.SYSTEMKEY,
                                                KW01.PAY_CD
                                         FROM PYYT0304 KW01) KW02
                                WHERE     KW02.DPOB_CD = BB.DPOB_CD
                                      AND KW02.PYYT_YR_MNTH = BB.PYMT_YR_MNTH
                                      AND KW02.SYSTEMKEY = BB.SYSTEMKEY
                                      AND KW02.PAY_CD = BB.PAY_CD)    
                                         GROUP BY                    BB.DPOB_CD 
      ,  BB.PYMT_YR_MNTH 
      ,  BB.SYSTEMKEY         
UNION ALL
SELECT BB.DPOB_CD 
      ,BB.PYMT_YR_MNTH 
      ,BB.SYSTEMKEY 
   ,  NVL( ( 
                                     SELECT SUM(PYMT_DDUC_FREE_DTY_SUM)
                                     FROM 
                                     (SELECT DPOB_CD
                                            ,PYMT_YR_MNTH
                                            , SYSTEMKEY
                                            , PAY_ITEM_CD
                                            , PYMT_DDUC_FREE_DTY_SUM  
                                          FROM  PAYR0302
                                         WHERE PAY_ITEM_CD  = 'C9100200'
                                             AND NOT EXISTS
                                              (SELECT *
                                                 FROM (SELECT KW01.DPOB_CD,
                                                              KW01.PYYT_YR_MNTH, 
                                                              KW01.SYSTEMKEY,
                                                                KW01.PAY_CD
                                                         FROM PYYT0304 KW01) KW02
                                                WHERE     KW02.DPOB_CD = PAYR0302.DPOB_CD
                                                      AND KW02.PYYT_YR_MNTH = PAYR0302.PYMT_YR_MNTH
                                                      AND KW02.SYSTEMKEY = PAYR0302.SYSTEMKEY
                                                      AND   KW02.PAY_CD = PAYR0302.PAY_CD) 
                                     UNION ALL
                                     SELECT  DPOB_CD
                                            ,PYYT_YR_MNTH
                                            ,SYSTEMKEY
                                            ,PYYT_ITEM_CD
                                            ,PYYT_PYDD_FREE_DTY_SUM  
                                          FROM  PYYT0302
                                         WHERE PYYT_ITEM_CD   = 'C9100200' ) A03   
                                         WHERE  A03.DPOB_CD = BB.DPOB_CD
                                           AND  A03.PYMT_YR_MNTH = BB.PYMT_YR_MNTH 
                                           AND  A03.SYSTEMKEY = BB.SYSTEMKEY
                                           AND  A03.PAY_ITEM_CD  = 'C9100200' 
                                         )
                                      , 0)   AS TAXM_SH03_BI /*  자가운전보조금    */
                          
                         , NVL( ( 
                                     SELECT SUM(PYMT_DDUC_FREE_DTY_SUM)
                                     FROM 
                                     (SELECT DPOB_CD
                                            ,PYMT_YR_MNTH
                                            , SYSTEMKEY
                                            , PAY_ITEM_CD
                                            , PYMT_DDUC_FREE_DTY_SUM  
                                          FROM  PAYR0302
                                         WHERE PAY_ITEM_CD  = 'C9080100'
                                           AND NOT EXISTS
                                              (SELECT *
                                                 FROM (SELECT KW01.DPOB_CD,
                                                              KW01.PYYT_YR_MNTH, 
                                                              KW01.SYSTEMKEY,
                                                                KW01.PAY_CD
                                                         FROM PYYT0304 KW01) KW02
                                                WHERE     KW02.DPOB_CD = PAYR0302.DPOB_CD
                                                      AND KW02.PYYT_YR_MNTH = PAYR0302.PYMT_YR_MNTH
                                                      AND KW02.SYSTEMKEY = PAYR0302.SYSTEMKEY
                                                      AND   KW02.PAY_CD =   PAYR0302.PAY_CD) 
                                     UNION ALL
                                     SELECT DPOB_CD
                                            ,PYYT_YR_MNTH
                                            ,SYSTEMKEY
                                            ,PYYT_ITEM_CD
                                            ,PYYT_PYDD_FREE_DTY_SUM  
                                          FROM  PYYT0302
                                         WHERE PYYT_ITEM_CD   = 'C9080100' ) A03   
                                         WHERE  A03.DPOB_CD = BB.DPOB_CD
                                           AND  A03.PYMT_YR_MNTH = BB.PYMT_YR_MNTH 
                                           AND  A03.SYSTEMKEY = BB.SYSTEMKEY
                                           AND  A03.PAY_ITEM_CD  = 'C9080100' 
                                         )
                                      , 0)   AS TAXM_SP01_BI
                         
                          , NVL( ( 
                                     SELECT SUM(PYMT_DDUC_FREE_DTY_SUM)
                                     FROM 
                                     (SELECT DPOB_CD
                                            ,PYMT_YR_MNTH
                                            , SYSTEMKEY
                                            , PAY_ITEM_CD
                                            , PYMT_DDUC_FREE_DTY_SUM  
                                          FROM  PAYR0302
                                         WHERE PAY_ITEM_CD  = 'C9050100'
                                           AND NOT EXISTS
                                              (SELECT *
                                                 FROM (SELECT KW01.DPOB_CD,
                                                              KW01.PYYT_YR_MNTH, 
                                                              KW01.SYSTEMKEY,
                                                                KW01.PAY_CD
                                                         FROM PYYT0304 KW01) KW02
                                                WHERE     KW02.DPOB_CD = PAYR0302.DPOB_CD
                                                      AND KW02.PYYT_YR_MNTH = PAYR0302.PYMT_YR_MNTH
                                                      AND KW02.SYSTEMKEY = PAYR0302.SYSTEMKEY
                                                      AND   KW02.PAY_CD =   PAYR0302.PAY_CD) 
                                     UNION ALL
                                     SELECT  DPOB_CD
                                            ,PYYT_YR_MNTH
                                            ,SYSTEMKEY
                                            ,PYYT_ITEM_CD
                                            ,PYYT_PYDD_FREE_DTY_SUM  
                                          FROM  PYYT0302
                                         WHERE PYYT_ITEM_CD   = 'C9050100' ) A03   
                                         WHERE  A03.DPOB_CD = BB.DPOB_CD
                                           AND  A03.PYMT_YR_MNTH = BB.PYMT_YR_MNTH 
                                           AND  A03.SYSTEMKEY = BB.SYSTEMKEY
                                           AND  A03.PAY_ITEM_CD  = 'C9050100' 
                                         )
                                      , 0)  AS TAXM_SQ01_BI  
  FROM   (
        SELECT   DISTINCT  AD02.DPOB_CD
                                              ,AD02.SYSTEMKEY
                                              ,AD02.PYYT_YR_MNTH AS PYMT_YR_MNTH
                                              ,AD02.PAYR_MANG_DEPT_CD
                                              ,AD02.EMYMT_DIV_CD
                                              ,AD02.HAN_NM
                                              ,AD02.RESN_REGN_NUM
                                              ,DECODE (AD02.EMYMT_DIV_CD, 'A0020020', AD02.DEPT_CD,DECODE(AD01.EMYMT_DIV_CD,'A0020020',AD02.DEPT_CD,AD01.CURR_AFFN_DEPT_CD)) AS DEPT_CD 
                                              ,DECODE (AD02.EMYMT_DIV_CD, 'A0020020', AD02.BUSIN_CD, DECODE(AD01.EMYMT_DIV_CD,'A0020020',AD02.BUSIN_CD,AD01.BUSIN_CD) ) AS BUSIN_CD  
                                              ,DECODE (AD02.EMYMT_DIV_CD, 'A0020020', AD02.TYP_OCCU_CD, DECODE(AD01.EMYMT_DIV_CD,'A0020020',AD02.TYP_OCCU_CD,AD01.TYP_OCCU_CD) ) AS TYP_OCCU_CD 
                                              ,DECODE (AD02.EMYMT_DIV_CD, 'A0020020', AD02.DTIL_OCCU_INTTN_CD, DECODE(AD01.EMYMT_DIV_CD,'A0020020',AD02.DTIL_OCCU_INTTN_CD,AD01.DTIL_OCCU_INTTN_CD) ) AS DTIL_OCCU_INTTN_CD 
                                              , DECODE (AD02.ODTY_CD,AD01.ODTY_CD, AD01.ODTY_CD,AD01.ODTY_CD) AS ODTY_CD 
                                                , DECODE (AD02.PYSP_CD, AD01.PYSP_CD, AD01.PYSP_CD, AD01.PYSP_CD) AS PYSP_CD  
                                                , DECODE (AD02.LOG_SVC_YR_NUM_CD, AD01.LOG_SVC_YR_NUM_CD, AD01.LOG_SVC_YR_NUM_CD, AD01.LOG_SVC_YR_NUM_CD) AS LOG_SVC_YR_NUM_CD 
                                                , DECODE (AD02.LOG_SVC_MNTH_ICM_CD, AD01.LOG_SVC_MNTH_ICM_CD, AD01.LOG_SVC_MNTH_ICM_CD, AD01.LOG_SVC_MNTH_ICM_CD) AS LOG_SVC_MNTH_ICM_CD 
                                                , DECODE (AD02.FRST_EMYMT_DT, AD01.FRST_EMYMT_DT, AD01.FRST_EMYMT_DT, AD01.FRST_EMYMT_DT) AS FRST_EMYMT_DT 
                                                , DECODE (AD02.EMYMT_BGNN_DT, AD01.EMYMT_BGNN_DT, AD01.EMYMT_BGNN_DT, AD01.EMYMT_BGNN_DT) AS EMYMT_BGNN_DT 
                                                , DECODE (AD02.EMYMT_END_DT, AD01.EMYMT_END_DT, AD01.EMYMT_END_DT, AD01.EMYMT_END_DT) AS EMYMT_END_DT 
                                              ,AD01.NATN_CD
                                              ,AD01.HDOFC_CODTN_CD
                                              ,AD01.RETRY_DT  
                                               FROM PSNL0100 AD01, ( 
                                            SELECT 
                                               DPOB_CD, PYYT_YR_MNTH, SYSTEMKEY, (0) AS PAYR_SEIL_NUM,('B0150000') AS PAY_CD,
                                               PAYR_MANG_DEPT_CD, EMYMT_DIV_CD, HAN_NM, 
                                               RESN_REGN_NUM, DEPT_CD, BUSIN_CD, 
                                               TYP_OCCU_CD, DTIL_OCCU_INTTN_CD, ODTY_CD, 
                                               PYSP_CD, LOG_SVC_YR_NUM_CD, LOG_SVC_MNTH_ICM_CD, 
                                               FRST_EMYMT_DT, EMYMT_BGNN_DT, EMYMT_END_DT, 
                                               HDOFC_DIV_CD, RETRY_DT 
                                            FROM  PYYT0304 ) AD02 ,
                                                (SELECT NN.DPOB_CD,
                                                        NN.PYYT_YR_MNTH ,
                                                        NN.SYSTEMKEY 
                                                 FROM    
                                                 (  SELECT   DPOB_CD, PYYT_YR_MNTH, SYSTEMKEY,  (0) AS PAYR_SEIL_NUM,('B0150000') AS PAY_CD,
                                                                               PAYR_MANG_DEPT_CD, EMYMT_DIV_CD, HAN_NM, 
                                                                               RESN_REGN_NUM, DEPT_CD, BUSIN_CD, 
                                                                               TYP_OCCU_CD, DTIL_OCCU_INTTN_CD, ODTY_CD, 
                                                                               PYSP_CD, LOG_SVC_YR_NUM_CD, LOG_SVC_MNTH_ICM_CD, 
                                                                               FRST_EMYMT_DT, EMYMT_BGNN_DT, EMYMT_END_DT, 
                                                                               HDOFC_DIV_CD, RETRY_DT 
                                                                            FROM  PYYT0304 
                                                                         WHERE     PYYT_YR_MNTH LIKE #yrtxBlggYr# ||'%'  
                                                             ) NN,
                                                              (  
                                                               SELECT        MM.DPOB_CD,
                                                                             MM.PYYT_YR_MNTH , 
                                                                             MM.SYSTEMKEY ,     MM.SEL_NUM
                                                                 FROM    
                                                                 (  
                                                                SELECT       SEL_NUM,
                                                                             DPOB_CD,
                                                                             PYYT_YR_MNTH , 
                                                                             SYSTEMKEY  
                                                                 FROM 
                                                                  (SELECT  ROW_NUMBER ()
                                                                             OVER (ORDER BY
                                                                                      DPOB_CD,
                                                                                      SYSTEMKEY,
                                                                                      PYYT_YR_MNTH ASC ) AS SEL_NUM,
                                                                             DPOB_CD,
                                                                             PYYT_YR_MNTH , 
                                                                             SYSTEMKEY   
                                                                        FROM PYYT0304   
                                                                           WHERE   PYYT_YR_MNTH  LIKE #yrtxBlggYr# ||'%'  
                                                                                       AND (SYSTEMKEY,PYYT_YR_MNTH) IN (
                                                                                          SELECT SYSTEMKEY, MAX(PYYT_YR_MNTH)
                                                                                            FROM PYYT0304 NNAA 
                                                                                            WHERE  NNAA.DPOB_CD = PYYT0304.DPOB_CD 
                                                                                              AND NNAA.PYYT_YR_MNTH = PYYT0304.PYYT_YR_MNTH
                                                                                              AND NNAA.SYSTEMKEY = PYYT0304.SYSTEMKEY
                                                                                              AND NNAA.PYYT_YR_MNTH  LIKE #yrtxBlggYr# ||'%'  
                                                                                              GROUP BY SYSTEMKEY
                   )
                                                                        )
                                                                          ORDER BY  SEL_NUM DESC 
                                                                        ) MM  
                                                                         WHERE ROWNUM = 1 
                                                                           AND DPOB_CD=#dpobCd#
                                                                           AND SYSTEMKEY=#systemkey# 
                                                                         ) GG
                                                        WHERE NN.DPOB_CD = GG.DPOB_CD
                                                          AND NN.SYSTEMKEY = GG.SYSTEMKEY  
                                                          AND NN.PYYT_YR_MNTH = GG.PYYT_YR_MNTH   
                                                                  ) AD03
                                                 WHERE     AD02.DPOB_CD = AD01.DPOB_CD
                                                       AND AD02.SYSTEMKEY = AD01.SYSTEMKEY
                                                       AND AD02.DPOB_CD = AD03.DPOB_CD
                                                       AND AD02.PYYT_YR_MNTH = AD03.PYYT_YR_MNTH
                                                       AND AD02.SYSTEMKEY = AD03.SYSTEMKEY 
                                                  AND AD02.PYYT_YR_MNTH LIKE #yrtxBlggYr# ||'%'  
         ) AA ,  (
         SELECT   AC01.DPOB_CD,AC01.PAY_CD,
                                    AC01.PYYT_YR_MNTH AS PYMT_YR_MNTH ,
                                    AC01.SYSTEMKEY,
                                    AC01.PAYR_MANG_DEPT_CD,
                                    AC01.EMYMT_DIV_CD,
                                    AC01.HAN_NM,
                                    ('') AS PAY_PYMT_DT
                      FROM PYYT0304 AC01
                      WHERE  AC01.SYSTEMKEY=#systemkey# 
                       GROUP BY AC01.DPOB_CD,
                                    AC01.PYYT_YR_MNTH, 
                                    AC01.PAY_CD,
                                    AC01.SYSTEMKEY,
                                    AC01.PAYR_MANG_DEPT_CD,
                                    AC01.EMYMT_DIV_CD,
                                    AC01.HAN_NM 
      ) BB   
            WHERE    BB.DPOB_CD=#dpobCd#  
               AND   BB.SYSTEMKEY=#systemkey# 
                   AND BB.DPOB_CD = AA.DPOB_CD
                   AND  BB.SYSTEMKEY = AA.SYSTEMKEY  
                   AND  BB.PYMT_YR_MNTH LIKE #yrtxBlggYr# ||'%' 
                    ]]>  
                   <isEqual prepend="AND" property="addCheck" compareValue="ADD">
                      NOT  EXISTS (SELECT *
                                     FROM (SELECT  KF01.DPOB_CD 
                                                 , KF01.YRTX_BLGG_YR
                                                 , KF01.CLUT_SEPT_CD 
                                                 , KF01.SYSTEMKEY 
                                             FROM YE160401 KF01 ) KK01
                                    WHERE     KK01.DPOB_CD = AA.DPOB_CD
                                          AND KK01.YRTX_BLGG_YR = #yrtxBlggYr#
                                          AND KK01.CLUT_SEPT_CD = #clutSeptCd# 
                                          AND KK01.SYSTEMKEY = AA.SYSTEMKEY)  
                  </isEqual>
                    <![CDATA[
                       GROUP BY                    BB.DPOB_CD 
      ,  BB.PYMT_YR_MNTH 
      ,  BB.SYSTEMKEY  
           )   
           GROUP BY  DPOB_CD 
      ,  PYMT_YR_MNTH 
      ,  SYSTEMKEY                                                        
      )
        ]]> 
	</insert> 
	
</sqlMap>
