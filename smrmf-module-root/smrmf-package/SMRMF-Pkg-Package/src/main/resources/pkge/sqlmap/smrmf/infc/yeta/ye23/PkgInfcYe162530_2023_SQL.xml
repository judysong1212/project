<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Ye162530_2023">
	
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="infcPkgYe162530Srh_2023_Vo" type="com.app.smrmf.infc.yearendtax.server.vo.yeta2023.InfcPkgYe162530Srh_2023_VO"/>
	
	<resultMap id="infcPkgYe162530_2023" class="com.app.smrmf.infc.yearendtax.server.vo.yeta2023.InfcPkgYe162530_2023_VO">
		<result property="yrtxBlggYr" column="YRTX_BLGG_YR" columnIndex="1"/> 
		<result property="clutSeptCd" column="CLUT_SEPT_CD" columnIndex="2"/> 
		<result property="rntlCttSeilNum" column="RNTL_CTT_SEIL_NUM" columnIndex="3"/>  
		<result property="dpobCd" column="DPOB_CD" columnIndex="4"/> 
		<result property="systemkey" column="SYSTEMKEY" columnIndex="5"/> 
		<result property="rntlCttLehdrNm" column="RNTL_CTT_LEHDR_NM" columnIndex="6"/>   
		<result property="rntlCttBusoprRgstnNum" column="RNTL_CTT_BUSOPR_RGSTNUM" columnIndex="7"/>   
		<result property="rntlCttHusFrmCd" column="RNTL_CTT_HUS_FRM_CD" columnIndex="8"/>  
		<result property="rntlCttHusCnttArea" column="RNTL_CTT_HUS_CNTT_AREA" columnIndex="9"/> 
		<result property="rntlCttAddr" column="RNTL_CTT_ADDR" columnIndex="10"/> 
		<result property="rntlCttPridBgnnDt" column="RNTL_CTT_PRID_BGNN_DT" columnIndex="11"/> 
		<result property="rntlCttPridEndDt" column="RNTL_CTT_PRID_END_DT" columnIndex="12"/> 
		<result property="rntlCttChrtrGrnteSum" column="RNTL_CTT_CHRTR_GRNTE_SUM" columnIndex="13"/> 
		<result property="kybdr" column="KYBDR" columnIndex="14"/>
		<result property="inptDt" column="INPT_DT" columnIndex="15"/>
		<result property="inptAddr" column="INPT_ADDR" columnIndex="16"/>
		<result property="ismt" column="ISMT" columnIndex="17"/>
		<result property="revnDt" column="REVN_DT" columnIndex="18"/>
		<result property="revnAddr" column="REVN_ADDR" columnIndex="19"/>
		<result property="ectnFlTrnrCtlYn" column="ECTN_FL_TRNR_CTL_YN" columnIndex="20"/> 
	</resultMap>
 
    
    <!-- G_거주자간_금전소비대차  -->
	<insert id="infcPkgYe162530_2023_DAO.incTaxDeducDec_nts_Yeta2023_Ye162530_Insert_S">
		<![CDATA[
			INSERT INTO YE162530 
                ( DPOB_CD				/* 사업장코드                      */
					,YRTX_BLGG_YR			/* 연말정산귀속년도			*/
					,CLUT_SEPT_CD			/* 정산구분코드			*/
					,SYSTEMKEY			/* SYSTEMKEY			*/
					,RNTL_CTT_SEIL_NUM		/* 임대차계약 일련번호		*/
					,TAX_VVAL_KRN_CD			/* 국세청자료구분코드			*/
					,RNTL_CTT_LEHDR_NM		/* G25_임대차계약_임대인성명_상호명	*/
					,RNTL_CTT_BUSOPR_RGSTNUM		/* G26_임대차계약_주민_사업자등록번호	*/
					,RNTL_CTT_HUS_FRM_CD		/* G27_임대차계약_주택유형코드		*/
					,RNTL_CTT_HUS_CNTT_AREA		/* G28_임대차계약_주택계약면적		*/
					,RNTL_CTT_ADDR			/* G29_임대차계약_임대차계약서상주소지	*/
					,RNTL_CTT_PRID_BGNN_DT		/* G30_임대차계약_임대차계약기간시작일자	*/
					,RNTL_CTT_PRID_END_DT		/* G31_임대차계약_임대차계약기간종료일자	*/
					,RNTL_CTT_CHRTR_GRNTE_SUM	/* G32_임대차계약_전세보증금액		*/
					,KYBDR				/* 입력자				*/
					,INPT_DT				/* 입력일자			*/
					,INPT_ADDR			/* 입력주소			*/
					,ISMT				/* 수정자				*/
					,REVN_DT				/* 수정일자			*/
					,REVN_ADDR			/* 수정주소			*/
 				)
               (
                SELECT 
					  DPOB_CD, YRTX_BLGG_YR, CLUT_SEPT_CD, 
					   SYSTEMKEY
				 , (SELECT NVL(MAX(RNTL_CTT_SEIL_NUM)+1,1) 
                      FROM YE162530 
                      WHERE DPOB_CD=#dpobCd#
                                AND YRTX_BLGG_YR=#yrtxBlggYr#
                                AND CLUT_SEPT_CD=#clutSeptCd#
                                AND SYSTEMKEY=#systemkey#)
                        ,'Y0140000'  /* 국세청 */            
					     , LSOR_FNM
					   , XPR_DSCM_NO_ENC_CNTN
					    ,  (CASE WHEN TRIM(HSNG_TYPE_CL_CD) = '단독주택' THEN 'Y0070001'
					    WHEN TRIM(HSNG_TYPE_CL_CD) = '다가구' THEN 'Y0070002'
					     WHEN TRIM(HSNG_TYPE_CL_CD) = '다세대주택' THEN 'Y0070003'
					      WHEN TRIM(HSNG_TYPE_CL_CD) = '연립주택' THEN 'Y0070004'
					       WHEN TRIM(HSNG_TYPE_CL_CD) = '아파트' THEN 'Y0070005'
					        WHEN TRIM(HSNG_TYPE_CL_CD) = '오피스텔' THEN 'Y0070006'
					         WHEN TRIM(HSNG_TYPE_CL_CD) = '고시원' THEN 'Y0070008'
					         ELSE 'Y0070009' END)  
					   , HSNG_CTR_SFL
					   ,   LSRN_CTRP_ADR 
					   , CTR_TERM_STRT_DT
					   , CTRR_TERM_END_DT
                       , LFH_DPIT 
                          , #kybdr# 
		                   , TO_CHAR(SYSDATE,'YYYYMMDDHHMISS') 
		                   , #inptAddr# 
		                   , #ismt# 
		                   , TO_CHAR(SYSDATE,'YYYYMMDDHHMISS') 
		                   , #revnAddr#
					FROM  YE167240 
                    WHERE DPOB_CD=#dpobCd#
					     AND YRTX_BLGG_YR=#yrtxBlggYr#
					     AND CLUT_SEPT_CD=#clutSeptCd#
					     AND SYSTEMKEY=#systemkey#   
               )
		]]>
	</insert>
	
    
    
	<insert id="infcPkgYe162530_2023_DAO.insertYe162530_S">
		<![CDATA[
			INSERT INTO YE162530 
                ( YRTX_BLGG_YR
                  , CLUT_SEPT_CD
                  , LEAS_SQNO
                  , DPOB_CD
                  , SYSTEMKEY
                  , RNTL_CTT_LEHDR_NM
                  , RNTL_CTT_BUSOPR_RGSTNUM
                  , RNTL_CTT_HUS_FRM_CD
                  , RNTL_CTT_HUS_CNTT_AREA
                  , RNTL_CTT_ADDR
                  , RNTL_CTT_PRID_BGNN_DT
                  , RNTL_CTT_PRID_END_DT
                  , RNTL_CTT_CHRTR_GRNTE_SUM 
                  , ECTN_FL_TRNR_CTL_YN )
            VALUES ( #yrtxBlggYr#
                  , #clutSeptCd#
                  , (SELECT NVL(MAX(LEAS_SQNO)+1,1) 
                      FROM YE162530 
                      WHERE DPOB_CD=#dpobCd#
                                AND YRTX_BLGG_YR=#yrtxBlggYr#
                                AND CLUT_SEPT_CD=#clutSeptCd#
                                AND SYSTEMKEY=#systemkey#) 
                  , #dpobCd#
                  , #systemkey#
                  , #rntlCttLehdrNm#
                  , #rntlCttBusoprRgstnNum#
                  , (fcBass0300ITEMNM(#dpobCd#, #rntlCttHusFrmCd#, '11'))
                  , #rntlCttHusCnttArea#
                  , #rntlCttAddr#
                  , #rntlCttPridBgnnDt#
                  , #rntlCttPridEndDt#
                  , #rntlCttChrtrGrnteSum# 
                  , #ectnFlTrnrCtlYn# )
		]]>
	</insert>
	
	<update id="infcPkgYe162530_2023_DAO.updateYe162530_S">
		<![CDATA[
			UPDATE YE162530
            SET YRTX_BLGG_YR=#yrtxBlggYr#
                , CLUT_SEPT_CD=#clutSeptCd#
                , RNTL_CTT_SEIL_NUM=#rntlCttSeilNum#
                , DPOB_CD=#dpobCd#
                , SYSTEMKEY=#systemkey#
                , RNTL_CTT_LEHDR_NM=#rntlCttLehdrNm#
                , RNTL_CTT_BUSOPR_RGSTNUM=#rntlCttBusoprRgstnNum#
                , RNTL_CTT_HUS_FRM_CD=(fcBass0300ITEMNM(#dpobCd#, #rntlCttHusFrmCd#, '11'))
                , RNTL_CTT_HUS_CNTT_AREA=#rntlCttHusCnttArea#
                , RNTL_CTT_ADDR=#rntlCttAddr#
                , RNTL_CTT_PRID_BGNN_DT=#rntlCttPridBgnnDt#
                , RNTL_CTT_PRID_END_DT=#rntlCttPridEndDt#
                , RNTL_CTT_CHRTR_GRNTE_SUM=#rntlCttChrtrGrnteSum#
                , ECTN_FL_TRNR_CTL_YN=#ectnFlTrnrCtlYn#
                        WHERE YRTX_BLGG_YR=#yrtxBlggYr#
                                AND CLUT_SEPT_CD=#clutSeptCd#
                                AND RNTL_CTT_SEIL_NUM=#rntlCttSeilNum#
                                AND DPOB_CD=#dpobCd#
                                AND SYSTEMKEY=#systemkey#
				]]>
	</update>
	
	<delete id="infcPkgYe162530_2023_DAO.deleteYe162530_S">
		<![CDATA[
			DELETE FROM YE162530 
						WHERE YRTX_BLGG_YR=#yrtxBlggYr#
								AND CLUT_SEPT_CD=#clutSeptCd#
								AND RNTL_CTT_SEIL_NUM=#rntlCttSeilNum#
								AND DPOB_CD=#dpobCd#
								AND SYSTEMKEY=#systemkey#
				]]>
	</delete>
	
	<!-- yeta0100 화면 연말정산 대상자 관리  -->
		<delete id="infcPkgYe162530_2023_DAO.fnPayr06430_PAYR451_CREATE_Delete_S">
		<![CDATA[
			DELETE FROM YE162530 
						WHERE YRTX_BLGG_YR=#yrtxBlggYr#
								AND CLUT_SEPT_CD=#clutSeptCd# 
								AND DPOB_CD=#dpobCd# 
				]]>
				  <isNotEmpty prepend="AND" property="systemkey" >
                      SYSTEMKEY=#systemkey#
                   </isNotEmpty> 
		    		  			    
	</delete>
	
	
	<select id="infcPkgYe162530_2023_DAO.selectYe162530_S" resultMap="infcPkgYe162530_2023">
		<![CDATA[
			SELECT
	                YRTX_BLGG_YR
	                , CLUT_SEPT_CD
	                , RNTL_CTT_SEIL_NUM
	                , DPOB_CD
	                , SYSTEMKEY
	                , RNTL_CTT_LEHDR_NM
	                , RNTL_CTT_BUSOPR_RGSTNUM
	                , RNTL_CTT_HUS_FRM_CD
	                , RNTL_CTT_HUS_CNTT_AREA
	                , RNTL_CTT_ADDR
	                , RNTL_CTT_PRID_BGNN_DT
	                , RNTL_CTT_PRID_END_DT
	                , RNTL_CTT_CHRTR_GRNTE_SUM
	                , ECTN_FL_TRNR_CTL_YN
	            FROM YE162530
	                        WHERE YRTX_BLGG_YR=#yrtxBlggYr#
	                                AND CLUT_SEPT_CD=#clutSeptCd#
	                                AND RNTL_CTT_SEIL_NUM=#rntlCttSeilNum#
	                                AND DPOB_CD=#dpobCd#
	                                AND SYSTEMKEY=#systemkey#
				]]>
	</select>
	
	<select id="infcPkgYe162530_2023_DAO.selectYe162530List_D" parameterClass="infcPkgYe162530Srh_2023_Vo" resultClass="egovMap">
	SELECT * FROM (
        SELECT A.*, ROWNUM RNUM FROM (
                    SELECT
                                    YRTX_BLGG_YR
                                    , CLUT_SEPT_CD
                                    , CLUT_SEPT_CD AS settGbcdcommCd 
                                    , fcBass0300CDNM(DPOB_CD, CLUT_SEPT_CD) AS settGbcdcommCdNm 
                                    , RNTL_CTT_SEIL_NUM
                                    , DPOB_CD
                                    , SYSTEMKEY
                                    , RNTL_CTT_LEHDR_NM
                                    , RNTL_CTT_BUSOPR_RGSTNUM
                                    , RNTL_CTT_HUS_FRM_CD
                                    , (SELECT C.COMM_CD 
                                            FROM BASS0300 C
                                            WHERE C.DPOB_CD = DPOB_CD
                                                    AND C.RPSTTV_CD = 'Y007'
                                                    AND    C.MANGE_ITEM11 = RNTL_CTT_HUS_FRM_CD)AS leasTyhucommCd
                                        , fcBass0300CDNM(DPOB_CD, (SELECT C.COMM_CD 
                                                                    FROM BASS0300 C
                                                                    WHERE C.DPOB_CD = DPOB_CD
                                                                        AND C.RPSTTV_CD = 'Y007'
                                                                        AND    C.MANGE_ITEM11 = RNTL_CTT_HUS_FRM_CD)) AS leasTyhucommCdNm 
                                    , RNTL_CTT_HUS_CNTT_AREA
                                    , RNTL_CTT_ADDR
                                    , RNTL_CTT_PRID_BGNN_DT
                                    , RNTL_CTT_PRID_END_DT
                                    , RNTL_CTT_CHRTR_GRNTE_SUM
                                    , KYBDR
                                    , INPT_DT
                                    , INPT_ADDR
                                    , ISMT
                                    , REVN_DT
                                    , REVN_ADDR
                                    , ECTN_FL_TRNR_CTL_YN
                            FROM YE162530
                    WHERE 
                        <isNotEmpty property="dpobCd">
                            DPOB_CD=#dpobCd#
                        </isNotEmpty>
                        <isNotEmpty prepend="AND" property="yrtxBlggYr" >
                            YRTX_BLGG_YR=#edacRvyy#
                        </isNotEmpty> 
                        <isNotEmpty prepend="AND" property="clutSeptCd" >
                            CLUT_SEPT_CD=#settGbcd#
                        </isNotEmpty> 
                        <isNotEmpty prepend="AND" property="systemkey" >
                            SYSTEMKEY=#systemkey#
                        </isNotEmpty>  
                        ORDER BY 
                            YRTX_BLGG_YR DESC
                                , CLUT_SEPT_CD DESC
                                , RNTL_CTT_SEIL_NUM DESC
                                , DPOB_CD DESC
                                , SYSTEMKEY DESC
            
            <![CDATA[                    
        ) A WHERE ROWNUM <= #lastIndex#
    )WHERE RNUM >= #firstIndex#
    ]]>
	</select>	
	<select id="infcPkgYe162530_2023_DAO.selectYe162530ListTotCnt_S" parameterClass="infcPkgYe162530Srh_2023_Vo" resultClass="int">
			SELECT COUNT(*) totcnt
			FROM YE162530
			WHERE 
				<isNotEmpty property="dpobCd">
					DPOB_CD=#dpobCd#
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="yrtxBlggYr" >
					YRTX_BLGG_YR=#edacRvyy#
				</isNotEmpty> 
				<isNotEmpty prepend="AND" property="clutSeptCd" >
					CLUT_SEPT_CD=#settGbcd#
				</isNotEmpty> 
				<isNotEmpty prepend="AND" property="systemkey" >
					SYSTEMKEY=#systemkey#
				</isNotEmpty>  
	</select>

</sqlMap>
