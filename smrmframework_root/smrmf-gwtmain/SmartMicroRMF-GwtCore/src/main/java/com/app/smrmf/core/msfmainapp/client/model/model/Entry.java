/*
 * Micro Smart Framework - Framework GWT (Google) + Ext GWT (Sencha) for RIA Applications
 * Copyright(c) 2014, atres
 * 
 * http://visionit.kr
 *
 */
package com.app.smrmf.core.msfmainapp.client.model.model;

import com.app.smrmf.core.msfmainapp.client.MSFMainApp;
import com.app.smrmf.core.msfmainapp.client.form.WindowFactory;
import com.app.smrmf.core.msfmainapp.shared.utils.MSFSharedUtils;

import com.extjs.gxt.ui.client.Style.HideMode;
import com.extjs.gxt.ui.client.data.BaseTreeModel;
import com.extjs.gxt.ui.client.widget.LayoutContainer;
import com.google.gwt.core.client.GWT;

public class Entry extends BaseTreeModel {

    private String id;
    private String name;
    private String upid;
    private boolean fill;
    private boolean closable = true;
    private HideMode hideMode = HideMode.DISPLAY;

    public Entry(String id, String name,String upid, /*LayoutContainer window*/ WindowFactory windowFactory, String image, String icon) {
        this.id = id;
        this.name = name;
        this.upid = upid;
        set(MSFMainApp.ATTR_ID,             id);
        set(MSFMainApp.ATTR_NAME,           name);
        set(MSFMainApp.ATTR_UPID,           upid);
        set(MSFMainApp.ATTR_IMAGE,          image);
        set(MSFMainApp.ATTR_ICON,           icon);
        set(MSFMainApp.ATTR_WINDOW_FACTORY, windowFactory);
        //set(MSFMainApp.ATTR_WINDOW, window);
    }

    public Entry(String id, String name, String upid,/*LayoutContainer window*/ WindowFactory windowFactory, String image, String icon, boolean fill) {
        this(id, name,upid, windowFactory, image, icon);
        this.fill = fill;
    }

    public Entry(String id, String name, String upid ,/*LayoutContainer window*/ WindowFactory windowFactory, String image, String icon, boolean fill, boolean closable) {
        this(id, name,upid, windowFactory, image, icon, fill);
        this.closable = closable;
    }

    public Entry(String id, String name,String upid , /*LayoutContainer window*/ WindowFactory windowFactory, String image, String icon, boolean fill, boolean closable, HideMode hideMode) {
        this(id, name, upid, windowFactory, image, icon, fill, closable);
        this.setHideMode(hideMode);
    }

    protected Entry() {

    }

    public LayoutContainer getWindow() {
        //return (LayoutContainer) get(MSFMainApp.ATTR_WINDOW);
        WindowFactory windowFactory = get(MSFMainApp.ATTR_WINDOW_FACTORY);
        LayoutContainer window = windowFactory.createWindow();
        return window;
    }

    public String getId() {
//        if (name.equals("% Columns")) {
//            return "percentcolumns";
//        }
//        return name.replaceAll(" ", "").toLowerCase();
        return (String) get(MSFMainApp.ATTR_ID);
    }
    
    public void setId(String id) {
        this.id = id;
        set(MSFMainApp.ATTR_ID, id);
    }

    public HideMode getHideMode() {
        return hideMode;
    }

    public String getName() {
        return (String) get(MSFMainApp.ATTR_NAME);
    }
    
    public String getUpid() {
    	return (String) get(MSFMainApp.ATTR_UPID);
    }


    public boolean isClosable() {
        return closable;
    }

    public boolean isFill() {
        return fill;
    }

    public void setFill(boolean fill) {
        this.fill = fill;
    }

    public void setHideMode(HideMode hideMode) {
        this.hideMode = hideMode;
    }

    public String toString() {
        return getName();
    }

    public String getSourceUrl() {
        String name = "";
        Object o = (Object) get(MSFMainApp.ATTR_WINDOW_FACTORY);
        if (o instanceof WindowFactory) {
            WindowFactory w = (WindowFactory)o;
             name = w.getWindowClassName(); 
             name = MSFSharedUtils.toLowerCase(id);
            
            if (MSFSharedUtils.paramNotNull(name)) {
                //source generated by java2html
                //name = name.substring(name.lastIndexOf(".client.") + 8);
                //name = "code/" + name + ".java.html";
                //name = name.replaceFirst("\\.", "/");

                //source generated by j2h
                //name = MSFSharedUtils.replace(name, ".", "/");
                name = "webHelp/paygenapp/exterm00000010/" + name + "/" + name + ".htm";
    
                if (!GWT.isScript()) {
                    name = "../../" + name;
                }
            }
        }
        return name;
    }

    /**
     * Clones the entry. This is used the create a new session, with right clink on menu item
     */
    public Entry clone(){
        Entry cloneEntry = 
            new Entry(
                    (String)this.get(MSFMainApp.ATTR_ID),
                    (String)this.get(MSFMainApp.ATTR_NAME),
                    (String)this.get(MSFMainApp.ATTR_UPID),
                    (WindowFactory)this.get(MSFMainApp.ATTR_WINDOW_FACTORY),
                    (String)this.get(MSFMainApp.ATTR_IMAGE),
                    (String)this.get(MSFMainApp.ATTR_ICON),
                    this.fill,
                    this.closable,
                    this.hideMode
                    );
        
        return cloneEntry;
    }
}
